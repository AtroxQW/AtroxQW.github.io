<!DOCTYPE html><html lang="en" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" type="image/png" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content=""><meta name="author" content="codeAtrox"><meta name="keywords" content=""><title>JavaWeb学习笔记 - Atrox的博客</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"example.com",root:"/",version:"1.8.7",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"ESDyAFj0rlPHtdaIfJoa3pTr-gzGzoHsz",app_key:"j9txoPTCSqfLMGi1UmkNO3vV",server_url:"AtroxQW.github.io"}}}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>AtroxQW</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于我</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(/img/bg/atrox1.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="JavaWeb学习笔记"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-12-31 10:14" pubdate>December 31, 2020 am</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 13.6k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 199 分钟</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">JavaWeb学习笔记</h1><div class="markdown-body"><h1 id="JavaWeb"><a href="#JavaWeb" class="headerlink" title="JavaWeb"></a>JavaWeb</h1><h2 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1. 基本概念"></a>1. 基本概念</h2><h3 id="1-1-前言"><a href="#1-1-前言" class="headerlink" title="1.1 前言"></a>1.1 前言</h3><p>web开发：</p><ul><li>web，网页的意思，<a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></li><li>静态web<ul><li>html、css</li><li>提供给所有人看的数据始终不会发生变化</li></ul></li><li>动态web<ul><li>淘宝，几乎是所有的网站</li><li>提供给所有人看的数据始终会发生变化，每个人在不同的时间，不同的地点看到的信息各不相同</li><li>技术栈：Servlet/JSP，ASP，PHP</li></ul></li></ul><p>在java中，动态web资源开发的技术统称为JavaWeb。</p><h3 id="1-2-web应用程序"><a href="#1-2-web应用程序" class="headerlink" title="1.2 web应用程序"></a>1.2 web应用程序</h3><p>web应用程序：可以提供浏览器访问的程序</p><ul><li>a.html、b.html ……多个web资源，这些web资源可以被外界访问，对外界提供服务</li><li>你们能访问到的任何一个页面和资源，都存在于某个角落的计算机上</li><li>URL：统一资源定位符</li><li>这些统一的web资源会被放在同一个文件夹下，web应用程序—&gt;Tomcat：服务器</li><li>一个web应用由多部分组成（静态web，动态web）<ul><li>html，css，js</li><li>jsp，servlet</li><li>java程序</li><li>jar包</li><li>配置文件（Properties）</li></ul></li></ul><p>web应用程序编写完毕后，若想提供给外界访问：需要一个服务器来统一管理</p><h3 id="1-3-静态web"><a href="#1-3-静态web" class="headerlink" title="1.3 静态web"></a>1.3 静态web</h3><ul><li>.htm，.html，这些都是网页的后缀，如果服务器上一直存在这些东西，我们就可以直接进行读取。通络：</li></ul><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E9%9D%99%E6%80%81web.png" srcset="/img/loading.gif" alt="静态web流程"></p><ul><li>静态web存在的缺点<ul><li>web页面无法动态更新，所有用户看到的都是同一个页面<ul><li>轮播图，点击特效：伪动态</li><li>JavaScript[实际开发中，它用的最多]</li><li>VBScript</li></ul></li><li>它无法和数据库交互（数据无法持久化，用户无法交互）</li></ul></li></ul><h3 id="1-4-动态web"><a href="#1-4-动态web" class="headerlink" title="1.4 动态web"></a>1.4 动态web</h3><p>页面会动态展示：“web的页面展示的效果因人而异”</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8A%A8%E6%80%81web.png" srcset="/img/loading.gif" alt="动态web流程"></p><p>缺点：</p><ul><li>假如服务器的动态web资源出现了错误，我们需要重新编写我们的<strong>后台程序</strong>，重新发布<ul><li>停机维护</li></ul></li></ul><p>优点：</p><ul><li>web页面可以动态更新，所有用户看到的都不是同一个页面</li><li>它可以和数据库交互（数据持久化：注册，[商品信息，用户信息]）</li></ul><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8A%A8%E6%80%81web%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%A4%E4%BA%92.png" srcset="/img/loading.gif" alt="动态web与数据库交互"></p><h2 id="2-web服务器"><a href="#2-web服务器" class="headerlink" title="2. web服务器"></a>2. web服务器</h2><h3 id="2-1-技术讲解"><a href="#2-1-技术讲解" class="headerlink" title="2.1 技术讲解"></a>2.1 技术讲解</h3><p>ASP</p><ul><li><p>微软：国内最早流行的就是ASP</p></li><li><p>在HTML中嵌入了VB的脚本，ASP + COM</p></li><li><p>在ASP开发中，基本一个页面都有几千行的业务代码，页面极其混乱</p></li><li><p>维护成本高</p></li><li><p>C#</p></li><li><p>iis服务器—Internet information Services可承载的Web核心</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><br>            &lt;%<br>             	System.out.println(&quot;/hello&quot;)  <br>             %&gt;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><p>PHP</p><ul><li>优势：PHP开发速度很快，功能很强大，跨平台，代码很简单（70%的网站为中轻量级的网站）</li><li>劣势：无法承载大访问量的情况（局限性）</li></ul><p>JSP/Servlet:</p><ul><li>SUN公司主推的<strong>B/S架构</strong></li><li>基于java语言的（所有的大公司，或者一些开源的组件，都是用java写的）</li><li>可以承载三高问题带来的影响：高并发、高可用、高性能</li><li>语法很像ASP，方便ASP开发人员转到JSP，加强市场竞争度</li></ul><p>……</p><h3 id="2-2-web服务器"><a href="#2-2-web服务器" class="headerlink" title="2.2 web服务器"></a>2.2 web服务器</h3><p>服务器是一种<strong>被动的操作</strong>，用来处理用户的一些请求和给用户一些响应信息。</p><p><strong>IIS</strong></p><ul><li>微软的：ASP……，Windows中自带的</li></ul><p><strong>Tomcat</strong></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/tomcat_logo.png" srcset="/img/loading.gif" alt="tomcat的logo"></p><ul><li><p>Tomcat是Apache 软件基金会（Apache Software Foundation）的Jakarta 项目中的一个核心项目。最新的Servlet 和JSP 规范总是能在Tomcat 中得到体现。因为Tomcat 技术先进、性能稳定，而且免费，因而深受Java 爱好者的喜爱并得到了部分软件开发商的认可，成为目前比较流行的Web 应用服务器。</p></li><li><p>Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E5%99%A8">服务器</a>，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试JSP 程序的首选。对于一个Java初学web的人来说，它是最佳的选择</p></li><li><p>Tomcat 实际上运行JSP 页面和Servlet。目前Tomcat最新版本为9.0.41。</p></li></ul><p><strong>工作3-5年之后，可以尝试手写Tomcat服务器</strong>；</p><p><strong>下载tomcat</strong>：</p><ol><li>安装 or 解压</li><li>了解配置文件及目录结构</li><li>了解它的作用</li></ol><h2 id="3-Tomcat"><a href="#3-Tomcat" class="headerlink" title="3. Tomcat"></a>3. Tomcat</h2><h3 id="3-1-安装Tomcat"><a href="#3-1-安装Tomcat" class="headerlink" title="3.1 安装Tomcat"></a>3.1 安装Tomcat</h3><p>Tomcat官网：<a target="_blank" rel="noopener" href="https://tomcat.apache.org/">https://tomcat.apache.org/</a></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/tomcat_install.png" srcset="/img/loading.gif" alt="Tomcat安装包"></p><p>下载完成后得到安压缩包</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/zip.png" srcset="/img/loading.gif" alt="压缩包"></p><h3 id="3-2-Tomcat启动和配置"><a href="#3-2-Tomcat启动和配置" class="headerlink" title="3.2 Tomcat启动和配置"></a>3.2 Tomcat启动和配置</h3><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/tomcat_folder.png" srcset="/img/loading.gif" alt="Tomcat目录结构"></p><p><strong>启动/关闭Tomcat</strong></p><p>在解压出的文件夹下的bin目录下</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/tomcat_start_shut.png" srcset="/img/loading.gif" alt="tomcat的启动与关闭"></p><p>访问测试：<a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080/</a></p><p>可能遇到的问题：</p><ol><li>java环境变量没有配置（造成闪退情况）</li><li>闪退问题：需要配置兼容性</li><li>乱码问题：配置文件中设置（尽量不要改动startup.bat文件的内容）</li></ol><h3 id="3-3-配置"><a href="#3-3-配置" class="headerlink" title="3.3 配置"></a>3.3 配置</h3><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/tomcat_coreConfig.png" srcset="/img/loading.gif" alt="tomcat核心配置文件"></p><p><strong>可以配置启动的端口号</strong></p><ul><li><p>tomcat的默认端口号为：8080</p></li><li><p>mysql：3306</p></li><li><p>http：80</p></li><li><p>https：443</p></li><li><pre><code class="c">    &lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;
               connectionTimeout=&quot;20000&quot;
               redirectPort=&quot;8443&quot; /&gt;
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>**可以配置启动的名称**<br><br>+ 默认的主机名为：localhost-&gt;127.0.0.1<br><br>+ 默认网站应用存放的位置为：webapps<br><br>+ ```c<br>  &lt;Host <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;localhost&quot;</span>  <span class="hljs-attribute">appBase</span>=<span class="hljs-string">&quot;webapps&quot;</span><br>             <span class="hljs-attribute">unpackWARs</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attribute">autoDeploy</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;<br></code></pre></td></tr></table></figure>
</code></pre></li></ul><p><strong>高难度面试题</strong>：请你谈一谈网站是如何进行访问的！</p><ol><li><p>输入一个域名：回车</p></li><li><p>检查本机的C:\Windows\System32\dirvers\etc\hosts配置文件下有没有这个域名的映射</p><ol><li><p>有：直接返回对应的ip地址，这个地址中，有我们需要访问的web程序，可以直接访问</p></li><li><p>无：去DNS服务器找，找到的话就返回，找不到就返回找不到。</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/websiteRequest.png" srcset="/img/loading.gif" alt="网站的访问"></p></li></ol></li></ol><h3 id="3-4-发布一个web网站"><a href="#3-4-发布一个web网站" class="headerlink" title="3.4 发布一个web网站"></a>3.4 发布一个web网站</h3><ul><li>将自己写的网站，放到服务器（Tomcat）中指定的web应用的文件夹（webapps）下，就可以访问了</li></ul><p>网站应该有的结构</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">--webapps : Tomcat服务器的web目录<br>    -Root<br>    -atroxStudy : 网站的目录名<br>        -WEB-INF<br>        	-classes : java程序<br>            -lib : web应用所依赖的jar包<br>        	-web.xml<br>        -index.html 默认的首页<br>        -<span class="hljs-keyword">static</span><br>            -css<br>                -style.css<br>            -js<br>            -img<br>        -……<br></code></pre></td></tr></table></figure><h2 id="4-Http"><a href="#4-Http" class="headerlink" title="4. Http"></a>4. Http</h2><h3 id="4-1-什么是HTTP"><a href="#4-1-什么是HTTP" class="headerlink" title="4.1 什么是HTTP"></a>4.1 什么是HTTP</h3><p>http（超文本传输协议）是一个简单的请求-响应协议，它通常运行在<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/TCP/33012">TCP</a>之上。</p><ul><li>文本：html、字符串、……</li><li>超文本：图片、音乐、视频、定位、地图……</li><li>Http默认端口80</li></ul><p>Https：安全的</p><ul><li>Https默认端口443</li></ul><h3 id="4-2-两个时代"><a href="#4-2-两个时代" class="headerlink" title="4.2 两个时代"></a>4.2 两个时代</h3><ul><li>http1.0<ul><li>HTTP/1.0：客户端可以于web服务器连接，只能获得一个web资源，断开连接</li></ul></li><li>http2.0<ul><li>HTTP/1.1：客户端可以于web服务器连接，可以获得多个web资源。</li></ul></li></ul><h3 id="4-3-Http请求"><a href="#4-3-Http请求" class="headerlink" title="4.3 Http请求"></a>4.3 Http请求</h3><ul><li>客户端–发请求（Request）–服务器</li></ul><p>百度：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Request URL: https:<span class="hljs-comment">//www.baidu.com/  请求地址</span><br>Request Method: GET   get方法/post方法<br>Status Code: <span class="hljs-number">200</span> OK   状态码：<span class="hljs-number">200</span><br>Remote Address: <span class="hljs-number">39.156</span><span class="hljs-number">.66</span><span class="hljs-number">.18</span>:<span class="hljs-number">443</span>  <br>Referrer Policy: no-referrer-when-downgrade<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Accept: text/html<br>Accept-Encoding: gzip, deflate, br<br>Accept-Language: zh-CN,zh;q=<span class="hljs-number">0.9</span><br>Cache-Control: max-age=<span class="hljs-number">0</span><br>Connection: keep-alive<br></code></pre></td></tr></table></figure><h4 id="4-3-1-请求行"><a href="#4-3-1-请求行" class="headerlink" title="4.3.1 请求行"></a>4.3.1 请求行</h4><ul><li>请求行中的请求方式：GET</li><li>请求方式：<strong>GET/POST</strong>/HEAD/DELETE/PUT/TRACT<ul><li>get：请求能够携带的参数比较少，大小有限制，<strong>会在浏览器的URL地址栏显示数据内容</strong>，不安全，但高效</li><li>post：请求能够携带的参数没有限制，大小没有限制，<strong>不会在浏览器的URL地址栏显示数据内容</strong>，安全，但不高效</li></ul></li></ul><h4 id="4-3-2-消息头"><a href="#4-3-2-消息头" class="headerlink" title="4.3.2 消息头"></a>4.3.2 消息头</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Accept: 告诉浏览器，它所支持的数据类型<br>Accept-Encoding: 支持哪种哪种编码格式 GBK UTF-<span class="hljs-number">8</span> GB2312 ISO8859-<span class="hljs-number">1</span><br>Accept-Language: 告诉浏览器，它的语言环境<br>Cache-Control: 缓存控制<br>Connection: 告诉浏览器，请求完是断开还是保持连接<br>HOST： 主机……/.<br></code></pre></td></tr></table></figure><h3 id="4-4-Http响应"><a href="#4-4-Http响应" class="headerlink" title="4.4 Http响应"></a>4.4 Http响应</h3><ul><li>服务器–响应–客户端</li></ul><p>百度：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Cache-Control: <span class="hljs-keyword">private</span>                  缓存控制<br>Connection: keep-alive                  连接<br>Content-Encoding: gzip                  编码<br>Content-Type: text/html;charset=utf-<span class="hljs-number">8</span>   类型<br></code></pre></td></tr></table></figure><h4 id="4-4-1-响应体"><a href="#4-4-1-响应体" class="headerlink" title="4.4.1 响应体"></a>4.4.1 响应体</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">Accept: 告诉浏览器，它所支持的数据类型<br>Accept-Encoding: 支持哪种哪种编码格式 GBK UTF-<span class="hljs-number">8</span> GB2312 ISO8859-<span class="hljs-number">1</span><br>Accept-Language: 告诉浏览器，它的语言环境<br>Cache-Control: 缓存控制<br>Connection: 告诉浏览器，请求完是断开还是保持连接<br>HOST： 主机……/.<br>Reflesh: 告诉客户端，多久刷新一次<br>Location: 让网页重新定位<br></code></pre></td></tr></table></figure><h3 id="4-4-2-相应状态码"><a href="#4-4-2-相应状态码" class="headerlink" title="4.4.2 相应状态码"></a>4.4.2 相应状态码</h3><p><strong>200</strong>：请求响应成功</p><p><strong>3xx</strong>：请求重定向</p><ul><li>重定向：你重新到我给你的新位置去</li></ul><p><strong>4xx</strong>：找不到资源 404</p><ul><li>资源不存在</li></ul><p><strong>5xx</strong>：服务器代码错误 500 502：网关错误</p><p><strong>常见面试题：</strong>当你的浏览器中地址栏输入地址并回车的一瞬间到页面能够展示回来，经历了什么？</p><h2 id="5-Maven"><a href="#5-Maven" class="headerlink" title="5.Maven"></a>5.Maven</h2><h3 id="5-1-为什么要学习Maven？"><a href="#5-1-为什么要学习Maven？" class="headerlink" title="5.1 为什么要学习Maven？"></a>5.1 为什么要学习Maven？</h3><ol><li>在JavaWeb开发中，需要使用大量的jar包，我们需要手动去导入；</li><li>如何能够让一个东西自动帮我导入和配置这个jar包；</li><li>由此，Maven诞生了！</li></ol><h3 id="5-2-Maven项目架构管理工具"><a href="#5-2-Maven项目架构管理工具" class="headerlink" title="5.2 Maven项目架构管理工具"></a>5.2 Maven项目架构管理工具</h3><p>我们目前用来就是方便导入jar包的！</p><p>Maven的核心思想：<strong>约定大于配置</strong></p><ul><li>有约束，不要去违反。</li></ul><p>Maven会规定好该如何去编写我们的Java代码，必须要按照这个规范来；</p><h3 id="5-3-下载安装Maven"><a href="#5-3-下载安装Maven" class="headerlink" title="5.3 下载安装Maven"></a>5.3 下载安装Maven</h3><p>官网地址：<a target="_blank" rel="noopener" href="http://maven.apache.org/">http://maven.apache.org/</a></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/maven_download.png" srcset="/img/loading.gif" alt="maven下载"></p><p>下载完成后，解压即可：</p><h3 id="5-4-配置环境变量"><a href="#5-4-配置环境变量" class="headerlink" title="5.4 配置环境变量"></a>5.4 配置环境变量</h3><p>在我们的系统环境变量中，配置如下配置：</p><ul><li>M2_HOME maven目录下的bin目录</li><li>MAVEN_HOME maven的目录</li><li>在系统的path中配置 %MAVEN_HOME%\bin</li></ul><p>cmd maven -v测试Maven是否安装成功，保证必须配置完毕！</p><h3 id="5-5-阿里云镜像"><a href="#5-5-阿里云镜像" class="headerlink" title="5.5 阿里云镜像"></a>5.5 阿里云镜像</h3><ul><li><p>镜像：mirrors</p><ul><li>作用：加速我们的下载</li></ul></li><li><p>国内建议使用阿里云的镜像</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">mirrors</span>&gt;</span><br>　　<span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br>　　　　<span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>alimaven<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>　　　　<span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br>　　　　<span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>aliyun maven<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>　　　　<span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>　　<span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mirrors</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="5-6-本地仓库"><a href="#5-6-本地仓库" class="headerlink" title="5.6 本地仓库"></a>5.6 本地仓库</h3><p>在本地的仓库，远程仓库</p><p>建立一个仓库，在配置文件setting.xml中</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">localRepository</span>&gt;</span>D:\SOMETOOLS\maven\apache-maven-3.6.3<span class="hljs-tag">&lt;/<span class="hljs-name">localRepository</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="5-7-在IDEA中使用Maven"><a href="#5-7-在IDEA中使用Maven" class="headerlink" title="5.7 在IDEA中使用Maven"></a>5.7 在IDEA中使用Maven</h3><p>1.启动IDEA</p><p>2.创建一个MavenWeb项目</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/new_maven_project.png" srcset="/img/loading.gif" alt="创建一个MavenWeb项目"></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/maven_gav.png" srcset="/img/loading.gif" alt="maven的gav"></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/maven_config.png" srcset="/img/loading.gif" alt="maven地址设置"></p><p>其中Bundled的为idea自带的maven设置。</p><p>3.等待初始化maven项目完毕</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/maven_project_init.png" srcset="/img/loading.gif" alt="maven自动导包"></p><p>4.观察Maven仓库中多了什么东西？</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/add_maven_repo.png" srcset="/img/loading.gif" alt="maven仓库中新增的包"></p><p>5.IDEA中的Maven设置</p><p>​ 注意：IDEA项目创建成功后，看一眼Maven的配置</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/idea_maven_settings.png" srcset="/img/loading.gif" alt="IDEA中的Maven设置"></p><p>6.到这里，Maven在IDEA中的设置和使用就完毕了！</p><h3 id="5-8-创建一个普通的Maven项目"><a href="#5-8-创建一个普通的Maven项目" class="headerlink" title="5.8 创建一个普通的Maven项目"></a>5.8 创建一个普通的Maven项目</h3><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/primary_maven_project_step1.png" srcset="/img/loading.gif" alt="第一步"></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clean_maven_project.png" srcset="/img/loading.gif" alt="干净的maven项目"></p><h3 id="5-9-在IDEA中标记文件夹功能"><a href="#5-9-在IDEA中标记文件夹功能" class="headerlink" title="5.9 在IDEA中标记文件夹功能"></a>5.9 在IDEA中标记文件夹功能</h3><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/mark_directory.png" srcset="/img/loading.gif" alt="标记文件夹功能"></p><p>或者采用第二种方式</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/mark_directory2.png" srcset="/img/loading.gif" alt="标记文件夹功能的第二种方式"></p><h3 id="5-10-在IDEA中配置Tomcat"><a href="#5-10-在IDEA中配置Tomcat" class="headerlink" title="5.10 在IDEA中配置Tomcat"></a>5.10 在IDEA中配置Tomcat</h3><p>第一步：在run中找到edit configuration</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/idea_select_tomcat.png" srcset="/img/loading.gif" alt="找到tomcat server"></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/tomcat_idea_config.png" srcset="/img/loading.gif" alt="新建一个template"></p><p>解决警告问题</p><p>必须要做的配置：<strong>为什么会有这个问题：我们访问一个网站，需要制定一个文件夹名字；</strong></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/tomcat_idea_artifacts.png" srcset="/img/loading.gif" alt="新建artifacts"></p><p>然后，需要做虚拟路径映射的设置</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/tomcat_virtual_path.png" srcset="/img/loading.gif" alt="虚拟路径映射"></p><p>然后，启动Tomcat</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%5Cidea_start_tomcat.png" srcset="/img/loading.gif" alt="idea启动Tomcat"></p><p>启动完成后，浏览器会自动打开localhost:8080/atrox/</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/idea_tomcat_run.png" srcset="/img/loading.gif" alt="tomcat启动情况"></p><p>maven侧边栏的讲解：</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/maven_sidebar.png" srcset="/img/loading.gif" alt="maven侧边栏的梳理"></p><h3 id="5-11-pom文件"><a href="#5-11-pom文件" class="headerlink" title="5.11 pom文件"></a>5.11 pom文件</h3><p>pom.xml 是maven的核心文件，解析如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><br><span class="hljs-comment">&lt;!--Maven版本和头文件--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!--这里就是刚才配置的GAV--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atrox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javaweb-01-maven<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!--Package：项目的打包方式</span><br><span class="hljs-comment">  jar: java应用</span><br><span class="hljs-comment">  war：javaWeb应用--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javaweb-01-maven Maven Webapp<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- FIXME change it to the project&#x27;s website --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://www.example.com<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!--配置--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--项目的默认构建编码--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--编译版本--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>1.7<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>1.7<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!--项目依赖--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--具体依赖的jar包配置文件--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!--项目构建用的东西--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>javaweb-01-maven<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span><span class="hljs-comment">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-clean-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- see http://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_war_packaging --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-resources-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.22.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-war-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-install-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-deploy-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>maven由于它的约定大于配置，之后可能会我们写的配置文件，无法被导出或者生效的问题。</p><p><strong>解决方案</strong>：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="5-12-解决遇到的问题"><a href="#5-12-解决遇到的问题" class="headerlink" title="5.12 解决遇到的问题"></a>5.12 解决遇到的问题</h3><p>1.Maven 3.6.2 无法导包</p><p>​ <strong>解决方法</strong>：降级为3.6.1</p><p>2.Tomcat闪退</p><p>​ <strong>解决办法</strong>：重新配置java的环境变量</p><p>3.IDEA中每次都要重复配置Maven</p><p>​ <strong>解决办法</strong>：在IDEA中的全局默认配置中去配置</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/idea_global_maven.png" srcset="/img/loading.gif" alt="全局配置maven"></p><p>4.Maven默认web项目中的web.xml版本问题</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/idea_default_webxml.png" srcset="/img/loading.gif" alt="idea默认生成的web appliaction版本"></p><p><strong>解决方案</strong>：IDEA自带的这个版本太老，应参考Tomcat中的文件Tomcat\apache-tomcat-9.0.41\webapps\ROOT\WEB-INF\web.xml，查到最佳版本为4.0,，将IDEA中的web.xml替换为Tomcat中web.xml的内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span><br><span class="hljs-tag"><span class="hljs-string">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">metadata-complete</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>5.Maven仓库的使用</p><p>Maven仓库官网：<a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a></p><h2 id="6-Servlet"><a href="#6-Servlet" class="headerlink" title="6. Servlet"></a>6. Servlet</h2><h3 id="6-1-Servlet简介"><a href="#6-1-Servlet简介" class="headerlink" title="6.1 Servlet简介"></a>6.1 Servlet简介</h3><ul><li><p>Servlet就是sun公司开发动态web的一门技术</p></li><li><p>Sun公司在这些API中提供一个接口，叫做：Servlet，如果你想开发一个Servlet程序，只需要完成两个小步骤：</p><ul><li>编写一个类，实现Servlet接口</li><li>把开发好的java类部署到web服务器中</li></ul></li></ul><p><strong>把实现了Servlet接口的java程序叫做，Servlet</strong></p><h3 id="6-2-HelloServlet"><a href="#6-2-HelloServlet" class="headerlink" title="6.2 HelloServlet"></a>6.2 HelloServlet</h3><p>Servlet接口在Sun公司有两个默认的实现类：HttpServlet、GenericServlet</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/servlet_extends.png" srcset="/img/loading.gif" alt="servlet实现接口"></p><ol><li><p>构建一个普通的Maven项目，删掉里面的src目录，以后就在这个项目里面建立module；这个空的工程就是Maven的主工程；</p></li><li><p>关于Maven父子工程的理解：</p><p>父项目中会有</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>servlet-01<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br></code></pre></td></tr></table></figure><p>子项目中会有</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javaweb-02-servlet<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atrox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><p>父项目中的java子项目可以直接使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">son extends parent<br></code></pre></td></tr></table></figure></li><li><p>Maven环境优化</p><ul><li>修改web.xml为最新的</li><li>编写一个</li></ul></li><li><p>编写一个Servlet程序</p><ul><li><p>编写一个普通类</p></li><li><p>实现Servlet接口，这里我们直接继承HttpServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br><br>    <span class="hljs-comment">// 由于get或者post只是请求实现的不同的方式，可以相互调用，业务逻辑都一样</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">// 响应流</span><br>        PrintWriter writer = resp.getWriter();<br><br>        writer.print(<span class="hljs-string">&quot;hello,Servlet&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-keyword">super</span>.doPost(req, resp);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ol><ol start="5"><li><p>编写Servlet的映射</p><p>为什么需要映射：这里写的是Java程序，但是要通过浏览器访问，而浏览器需要连接web服务器。所以，我们需要在web服务中注册我们写的Servlet，还需给它一个浏览器能够访问的路径。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-comment">&lt;!--注册Servlet--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.atrox.servlet.HelloServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><span class="hljs-comment">&lt;!--Servlet的请求路径--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>配置Tomcat</p><p>注意：如果添加artifacts消失，刷新一下项目</p></li><li><p>启动测试</p></li></ol><h3 id="6-3-Servlet运行原理"><a href="#6-3-Servlet运行原理" class="headerlink" title="6.3 Servlet运行原理"></a>6.3 Servlet运行原理</h3><p>Servlet是由Web服务器（Tomcat）调用的，web服务器在收到浏览器请求会后，会：</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/servlet_yuanli.png" srcset="/img/loading.gif" alt="Servlet运行原理"></p><h3 id="6-4-Mapping问题"><a href="#6-4-Mapping问题" class="headerlink" title="6.4 Mapping问题"></a>6.4 Mapping问题</h3><ol><li><p>一个Servlet可以指定一个映射路径</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/hello<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>一个Servlet可以指定多个映射路径</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/hello1<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/hello2<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/hello3<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>一个Servlet可以指定通用映射路径</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/hello/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>默认请求路径</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>指定一些后缀或者前缀等</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--可以自定义后缀实现请求映射--&gt;</span><br><span class="hljs-comment">&lt;!--注意点：*前面不能加映射的路径--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.atrox<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>优先级问题</p><p>制定了固有的映射路径优先级最高，如果找不到就会找默认的请求路径处理</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--404--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>error<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.atrox.servlet.ErrorServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>error<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="6-5-ServletContext"><a href="#6-5-ServletContext" class="headerlink" title="6.5 ServletContext"></a>6.5 ServletContext</h3><p>web容器<strong>在启动的时候</strong>，它会为每个web程序都创建一个对应的ServletContext对象，它代表了当前的web应用。</p><h4 id="6-5-1-共享数据"><a href="#6-5-1-共享数据" class="headerlink" title="6.5.1 共享数据"></a>6.5.1 共享数据</h4><p>我在这个Servlet中保存的数据，可以在另外一个Servlet中拿到</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/servletContext_shareData.png" srcset="/img/loading.gif" alt="共享数据"></p><p>放数据的类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>        <span class="hljs-comment">//        this.getInitParameter() 初始化参数</span><br><br>        <span class="hljs-comment">//        this.getServletConfig() Servlet配置</span><br><br>        <span class="hljs-comment">//        this.getServletContext() Servlet上下文</span><br>        ServletContext context = <span class="hljs-keyword">this</span>.getServletContext();<br><br>        String userName = <span class="hljs-string">&quot;乔威&quot;</span>; <span class="hljs-comment">// 数据</span><br>        context.setAttribute(<span class="hljs-string">&quot;userName&quot;</span>,userName); <span class="hljs-comment">//将一个数据保存在ServletContext中，key:userName,value:userName</span><br><br>        System.out.println(<span class="hljs-string">&quot;Hello&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>读数据的类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>        ServletContext context = <span class="hljs-keyword">this</span>.getServletContext();<br><br>        String userName = (String) context.getAttribute(<span class="hljs-string">&quot;userName&quot;</span>);<br><br>        resp.setContentType(<span class="hljs-string">&quot;text/html&quot;</span>);<br>        resp.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>        resp.getWriter().print(userName);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>映射</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.atrox.servlet.HelloServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/hello<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>getc<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.atrox.servlet.GetServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>getc<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/getc<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure><p>需要先访问/hello页面，让它放数据，再访问/getc页面拿数据，否则如果直接访问/getc页面，会显示null</p><h4 id="6-5-2-获取初始化参数"><a href="#6-5-2-获取初始化参数" class="headerlink" title="6.5.2 获取初始化参数"></a>6.5.2 获取初始化参数</h4><p>web.xml中</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置一些web应用初始化参数--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>url<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>jdbc:mysql://localhost:3306/mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br></code></pre></td></tr></table></figure><p>servlet-demo中取出这些初始化参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServletDemo03</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HelloServlet</span></span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>        ServletContext context = <span class="hljs-keyword">this</span>.getServletContext();<br>        String url = context.getInitParameter(<span class="hljs-string">&quot;url&quot;</span>);<br>        resp.getWriter().print(url);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="6-5-3-请求转发"><a href="#6-5-3-请求转发" class="headerlink" title="6.5.3 请求转发"></a>6.5.3 请求转发</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServletDemo04</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>        ServletContext context = <span class="hljs-keyword">this</span>.getServletContext();<br><br>        <span class="hljs-comment">// 转发的请求路径</span><br>        <span class="hljs-comment">//        RequestDispatcher dispatcher = context.getRequestDispatcher(&quot;/demo3&quot;);</span><br>        <span class="hljs-comment">// 调用 forward 方法实现请求转发</span><br>        <span class="hljs-comment">//        dispatcher.forward(req,resp);</span><br>        context.getRequestDispatcher(<span class="hljs-string">&quot;/demo3&quot;</span>).forward(req,resp);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/servletContext_request_dispather.png" srcset="/img/loading.gif" alt="请求转发"></p><h4 id="6-5-4-读取资源文件"><a href="#6-5-4-读取资源文件" class="headerlink" title="6.5.4 读取资源文件"></a>6.5.4 读取资源文件</h4><p>Properties</p><ul><li>在java目录下新建properties</li><li>在resources目录下新建properties</li></ul><p>发现：都被打包到了同一个路径下：classes，俗称这个路径为classPath</p><p>思路：需要一个文件流：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">password</span>=<span class="hljs-string">zuiweizhiming666</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Servlet05</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>        InputStream is = <span class="hljs-keyword">this</span>.getServletContext().getResourceAsStream(<span class="hljs-string">&quot;/WEB-INF/classes/db.properties&quot;</span>);<br><br>        Properties prop = <span class="hljs-keyword">new</span> Properties();<br>        prop.load(is);<br><br>        String username = prop.getProperty(<span class="hljs-string">&quot;username&quot;</span>);<br>        String password = prop.getProperty(<span class="hljs-string">&quot;password&quot;</span>);<br><br>        resp.getWriter().print(username + <span class="hljs-string">&quot;:&quot;</span> + password);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-6-HttpServletReponse"><a href="#6-6-HttpServletReponse" class="headerlink" title="6.6 HttpServletReponse"></a>6.6 HttpServletReponse</h3><p>web服务器接收到客户端的http请求，针对这个请求，分别创建一个代表请求的HttpServiceRequest对象，代表响应的一个HttpServletResponse；</p><ul><li>如果要获取客户端请求过来的参数：找HttpServletRequest</li><li>如果要给客户端响应一些信息：找HttpServletResponse</li></ul><h4 id="6-6-1-简单分类"><a href="#6-6-1-简单分类" class="headerlink" title="6.6.1 简单分类"></a>6.6.1 简单分类</h4><p><strong>负责向浏览器发送数据的方法</strong>：</p><ul><li><pre><code class="java">// 在HttpServletResponse继承的ServletResponse中的方法
ServletOutputStream getOutputStream() throws IOException;
PrintWriter getWriter() throws IOException;
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><br>**负责向浏览器发送响应头的方法**<br><br>+ ```java<br>  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setCharacterEncoding</span><span class="hljs-params">(<span class="hljs-keyword">String</span> var1)</span></span>;<br>  <br>  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setContentLength</span><span class="hljs-params">(<span class="hljs-keyword">int</span> var1)</span></span>;<br>  <br>  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setContentLengthLong</span><span class="hljs-params">(<span class="hljs-keyword">long</span> var1)</span></span>;<br>  <br>  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setContentType</span><span class="hljs-params">(<span class="hljs-keyword">String</span> var1)</span></span>;<br>  <br>  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setStatus</span><span class="hljs-params">(<span class="hljs-keyword">int</span> var1)</span></span>;<br></code></pre></td></tr></table></figure>
</code></pre></li></ul><p><strong>状态码定义</strong></p><ul><li><pre><code class="java">int SC_CONTINUE = 100;
int SC_SWITCHING_PROTOCOLS = 101;
int SC_OK = 200;
int SC_CREATED = 201;
int SC_ACCEPTED = 202;
int SC_NON_AUTHORITATIVE_INFORMATION = 203;
int SC_NO_CONTENT = 204;
int SC_RESET_CONTENT = 205;
int SC_PARTIAL_CONTENT = 206;
int SC_MULTIPLE_CHOICES = 300;
int SC_MOVED_PERMANENTLY = 301;
int SC_MOVED_TEMPORARILY = 302;
int SC_FOUND = 302;
int SC_SEE_OTHER = 303;
int SC_NOT_MODIFIED = 304;
int SC_USE_PROXY = 305;
int SC_TEMPORARY_REDIRECT = 307;
int SC_BAD_REQUEST = 400;
int SC_UNAUTHORIZED = 401;
int SC_PAYMENT_REQUIRED = 402;
int SC_FORBIDDEN = 403;
int SC_NOT_FOUND = 404;
int SC_METHOD_NOT_ALLOWED = 405;
int SC_NOT_ACCEPTABLE = 406;
int SC_PROXY_AUTHENTICATION_REQUIRED = 407;
int SC_REQUEST_TIMEOUT = 408;
int SC_CONFLICT = 409;
int SC_GONE = 410;
int SC_LENGTH_REQUIRED = 411;
int SC_PRECONDITION_FAILED = 412;
int SC_REQUEST_ENTITY_TOO_LARGE = 413;
int SC_REQUEST_URI_TOO_LONG = 414;
int SC_UNSUPPORTED_MEDIA_TYPE = 415;
int SC_REQUESTED_RANGE_NOT_SATISFIABLE = 416;
int SC_EXPECTATION_FAILED = 417;
int SC_INTERNAL_SERVER_ERROR = 500;
int SC_NOT_IMPLEMENTED = 501;
int SC_BAD_GATEWAY = 502;
int SC_SERVICE_UNAVAILABLE = 503;
int SC_GATEWAY_TIMEOUT = 504;
int SC_HTTP_VERSION_NOT_SUPPORTED = 505;
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs scala"><br>#### <span class="hljs-number">6.6</span><span class="hljs-number">.2</span> 常见应用<br><br><span class="hljs-number">1.</span> 向浏览器输出消息（getWriter再print）<br><br>#### <span class="hljs-number">6.6</span><span class="hljs-number">.3</span> 下载文件<br><br><span class="hljs-number">1.</span> 要获取下载文件的路径<br><span class="hljs-number">2.</span> 下载的文件名是啥<br><span class="hljs-number">3.</span> 设置想办法让浏览器能够支持下载需要的东西<br><span class="hljs-number">4.</span> 获取下载文件的输入流<br><span class="hljs-number">5.</span> 创建缓冲区buffer<br><span class="hljs-number">6.</span> 获取<span class="hljs-type">OutputStream</span>对象<br><span class="hljs-number">7.</span> 将<span class="hljs-type">FileInputStream</span>流写入到buffer缓冲区<br><span class="hljs-number">8.</span> 使用<span class="hljs-type">OutputStream</span>将缓冲区中的数据输出到客户端<br><br><span class="hljs-type">Java</span>文件下载代码<br><br>```java<br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> void doGet(<span class="hljs-type">HttpServletRequest</span> req, <span class="hljs-type">HttpServletResponse</span> resp) <span class="hljs-keyword">throws</span> <span class="hljs-type">ServletException</span>, <span class="hljs-type">IOException</span> &#123;<br>        <span class="hljs-comment">//    1. 要获取下载文件的路径</span><br>        <span class="hljs-type">String</span> path = <span class="hljs-string">&quot;F:\\360MoveData\\Users\\M\\Desktop\\学习\\JavaWebStudy\\javaweb-02-servlet\\response\\target\\classes\\弹幕.png&quot;</span>;<br>        <span class="hljs-type">System</span>.out.println(<span class="hljs-string">&quot;下载文件的路径为：&quot;</span> + path);<br>        <span class="hljs-comment">//    2. 下载的文件名是啥</span><br>        <span class="hljs-type">String</span> fileName = path.substring(path.lastIndexOf(<span class="hljs-string">&quot;//&quot;</span>) + <span class="hljs-number">1</span>);<br>        <span class="hljs-comment">//    3. 设置想办法让浏览器能够支持(Content-Disposition)下载需要的东西，中文文件明URLEncoder.encode编码，否则可能有乱码</span><br>        resp.setHeader(<span class="hljs-string">&quot;Content-Disposition&quot;</span>,<span class="hljs-string">&quot;attachment;filename=&quot;</span> + <span class="hljs-type">URLEncoder</span>.encode(fileName,<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>        <span class="hljs-comment">//    4. 获取下载文件的输入流</span><br>        <span class="hljs-type">FileInputStream</span> fis = <span class="hljs-keyword">new</span> <span class="hljs-type">FileInputStream</span>(path);<br>        <span class="hljs-comment">//    5. 创建缓冲区buffer</span><br>        int len = <span class="hljs-number">0</span>;<br>        byte[] buffer = <span class="hljs-keyword">new</span> byte[<span class="hljs-number">1024</span>];<br>        <span class="hljs-comment">//    6. 获取OutputStream对象</span><br>        <span class="hljs-type">ServletOutputStream</span> os = resp.getOutputStream();<br>        <span class="hljs-comment">//    7. 将FileInputStream流写入到buffer缓冲区,使用OutputStream将缓冲区中的数据输出到客户端</span><br>        <span class="hljs-keyword">while</span> ((len = fis.read(buffer)) &gt;<span class="hljs-number">0</span>) &#123;<br>            os.write(buffer, <span class="hljs-number">0</span>, len);<br>        &#125;<br>        fis.close();<br>        os.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</code></pre></li></ul><h4 id="6-6-4-验证码功能"><a href="#6-6-4-验证码功能" class="headerlink" title="6.6.4 验证码功能"></a>6.6.4 验证码功能</h4><p>验证码从何而来？</p><ul><li><p>前端实现</p></li><li><p>后端实现，需要用到 Java 的图片类，生产一个图片</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atrox.servlet;<br><br><span class="hljs-keyword">import</span> javax.imageio.ImageIO;<br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.swing.*;<br><span class="hljs-keyword">import</span> java.awt.*;<br><span class="hljs-keyword">import</span> java.awt.image.BufferedImage;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.Random;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>        <span class="hljs-comment">// 如何让浏览器3秒自动刷新一次</span><br>        resp.setHeader(<span class="hljs-string">&quot;refresh&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>);<br>        <span class="hljs-comment">// 在内存中创建一个图片</span><br>        BufferedImage image = <span class="hljs-keyword">new</span> BufferedImage(<span class="hljs-number">80</span>,<span class="hljs-number">20</span>,BufferedImage.TYPE_INT_RGB);<br>        <span class="hljs-comment">// 得到图片</span><br>        Graphics2D graphics = (Graphics2D) image.getGraphics(); <span class="hljs-comment">//画笔</span><br>        <span class="hljs-comment">// 设置图片的背景颜色</span><br>        graphics.setColor(Color.white);<br>        graphics.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">80</span>, <span class="hljs-number">20</span>);<br>        <span class="hljs-comment">// 给图片写数据</span><br>        graphics.setColor(Color.blue);<br>        graphics.setFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-keyword">null</span>,Font.BOLD, <span class="hljs-number">20</span>));<br>        graphics.drawString(makeNum(), <span class="hljs-number">0</span>, <span class="hljs-number">20</span>);<br><br>        <span class="hljs-comment">// 告诉浏览器，这个请求用图片的方式打开</span><br>        resp.setContentType(<span class="hljs-string">&quot;image/jpeg&quot;</span>);<br>        <span class="hljs-comment">// 网站存在缓存，不让浏览器缓存</span><br>        resp.setDateHeader(<span class="hljs-string">&quot;expires&quot;</span>, -<span class="hljs-number">1</span>);<br>        resp.setHeader(<span class="hljs-string">&quot;Cache-control&quot;</span>, <span class="hljs-string">&quot;no-cache&quot;</span>);<br>        resp.setHeader(<span class="hljs-string">&quot;Pragma&quot;</span>, <span class="hljs-string">&quot;no-cache&quot;</span>);<br><br>        <span class="hljs-comment">//把图片写给浏览器</span><br>        ImageIO.write(image, <span class="hljs-string">&quot;jpg&quot;</span>, resp.getOutputStream());<br><br>    &#125;<br><br>    <span class="hljs-comment">// 生成随机数</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">makeNum</span><span class="hljs-params">()</span> </span>&#123;<br><br>        Random random = <span class="hljs-keyword">new</span> Random();<br>        String num = random.nextInt(<span class="hljs-number">9999999</span>) + <span class="hljs-string">&quot;&quot;</span>;<br>        StringBuffer sb = <span class="hljs-keyword">new</span> StringBuffer();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">7</span> - num.length(); i++) &#123;<br>            sb.append(<span class="hljs-string">&quot;0&quot;</span>);<br>        &#125;<br>        String s = sb.toString() + num;<br>        <span class="hljs-keyword">return</span> num;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-keyword">super</span>.doPost(req, resp);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul><h4 id="6-6-5-实现重定向"><a href="#6-6-5-实现重定向" class="headerlink" title="6.6.5 实现重定向"></a>6.6.5 实现重定向</h4><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redirect.png" srcset="/img/loading.gif" alt="重定向问题"></p><p>一个web资源受到客户端请求后，会通知客户端去访问另外一个web资源，这个过程为重定向。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendRedirect</span><span class="hljs-params">(String var1)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br></code></pre></td></tr></table></figure><p>常见场景：</p><ul><li>用户登录`</li></ul><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>    resp.setHeader(<span class="hljs-string">&quot;Location&quot;</span>, <span class="hljs-string">&quot;/response_war/img&quot;</span>);<br>    resp.setStatus(<span class="hljs-number">302</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>面试题</strong>：请你聊聊重定向和转发的区别</p><p>相同点：</p><ul><li>页面都会实现跳转</li></ul><p>不同点：</p><ul><li>请求转发的时候，url不会产生变化</li><li>重定向的时候，url地址栏会发生变化；</li></ul><h3 id="6-7-HttpServletRequest"><a href="#6-7-HttpServletRequest" class="headerlink" title="6.7 HttpServletRequest"></a>6.7 HttpServletRequest</h3><p>HttpServletRequest代表客户端的请求，用户通过Http协议访问服务器，HTTP请求中的所有信息会被封装到HttpServletRequest，通过这个HttpServletRequest的方法，获取客户端的所有信息：</p><p><img src="JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/httpServletRequest_get.png" srcset="/img/loading.gif" alt="可以获取的客户端信息"></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/client_info.png" srcset="/img/loading.gif" alt="客户端的信息"></p><h4 id="6-7-1-获取前端传递的参数-请求转发"><a href="#6-7-1-获取前端传递的参数-请求转发" class="headerlink" title="6.7.1 获取前端传递的参数,请求转发"></a>6.7.1 获取前端传递的参数,请求转发</h4><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/request_get_paras.png" srcset="/img/loading.gif" alt="获取前端传递参数"></p><p>前端JSP页面：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;body&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-align: center&quot;</span>&gt;<br>        &lt;form action=<span class="hljs-string">&quot;$&#123;pageContext.request.contextPath&#125;/login&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br>            用户名：&lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;userName&quot;</span>&gt; &lt;br&gt;<br>            密码：&lt;input type=<span class="hljs-string">&quot;pawwpord&quot;</span> name=<span class="hljs-string">&quot;password&quot;</span>&gt; &lt;br&gt;<br>            爱好：<br>            &lt;input type=<span class="hljs-string">&quot;checkbox&quot;</span> name=<span class="hljs-string">&quot;hobby&quot;</span> value=<span class="hljs-string">&quot;女孩&quot;</span>&gt;女孩<br>            &lt;input type=<span class="hljs-string">&quot;checkbox&quot;</span> name=<span class="hljs-string">&quot;hobby&quot;</span> value=<span class="hljs-string">&quot;代码&quot;</span>&gt;代码<br>            &lt;input type=<span class="hljs-string">&quot;checkbox&quot;</span> name=<span class="hljs-string">&quot;hobby&quot;</span> value=<span class="hljs-string">&quot;电影&quot;</span>&gt;电影<br>            &lt;input type=<span class="hljs-string">&quot;checkbox&quot;</span> name=<span class="hljs-string">&quot;hobby&quot;</span> value=<span class="hljs-string">&quot;唱歌&quot;</span>&gt;唱歌<br>            &lt;br&gt;<br>            &lt;input type=<span class="hljs-string">&quot;submit&quot;</span>&gt;<br>        &lt;/form&gt;<br>    &lt;/div&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>登录成功JSP页面:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;登录成功&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;h1&gt;登录成功&lt;/h1&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>获取前端参数，请求转发：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>    req.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>    resp.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br><br>    String userName = req.getParameter(<span class="hljs-string">&quot;userName&quot;</span>);<br>    String password = req.getParameter(<span class="hljs-string">&quot;password&quot;</span>);<br>    String[] hobbies = req.getParameterValues(<span class="hljs-string">&quot;hobby&quot;</span>);<br><br>    System.out.println(<span class="hljs-string">&quot;==========================&quot;</span>);<br>    System.out.println(userName);<br>    System.out.println(password);<br>    System.out.println(Arrays.toString(hobbies));<br>    System.out.println(<span class="hljs-string">&quot;==========================&quot;</span>);<br><br>    <span class="hljs-comment">// 通过请求转发</span><br>    <span class="hljs-comment">// 这里的 / 代表当前的web应用</span><br>    req.getRequestDispatcher(<span class="hljs-string">&quot;/success.jsp&quot;</span>).forward(req,resp);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>面试题：</strong>请你聊聊重定向和转发的区别？</p><p>相同点：</p><ul><li>页面都会实现跳转</li></ul><p>不同点：</p><ul><li>请求转发的时候，url不会产生变化；307</li><li>重定向的时候，url地址栏产生变化；302</li></ul><h3 id="6-8-Cookie和Session"><a href="#6-8-Cookie和Session" class="headerlink" title="6.8 Cookie和Session"></a>6.8 Cookie和Session</h3><h4 id="6-8-1-会话"><a href="#6-8-1-会话" class="headerlink" title="6.8.1 会话"></a>6.8.1 会话</h4><p><strong>会话</strong>：用户打开一个浏览器，点击了某些超链接，访问多个web资源，关闭浏览器。这个过程，可以称为会话。</p><p><strong>有状态会话</strong>：一个同学来过教师，下次再来教室，我们会知道这个同学，曾经来过，称之为有状态会话。</p><p><strong>例子</strong>：如何证明你是某大学的学生？</p><ul><li><p>报名缴费的发票 学校给你发票</p></li><li><p>学校登记 学校标记你来过了</p></li></ul><p><strong>那对于一个网站，如何证明你来过呢？</strong></p><p>客户端 服务端</p><p>1.服务端给客户端一个信件，客户端下次访问服务端带上信件就可以了。</p><p>2.服务器登记你来过了，下次你来的时候我来匹配你。</p><h4 id="6-8-2-保存会话的两种技术"><a href="#6-8-2-保存会话的两种技术" class="headerlink" title="6.8.2 保存会话的两种技术"></a>6.8.2 保存会话的两种技术</h4><p><strong>cookie</strong></p><ul><li>客户端技术（响应，请求）</li></ul><p><strong>session</strong></p><ul><li>服务器技术，利用这个技术，可以保存用户的会话信息。我们可以把信息或者数据放在session中。</li></ul><p>常见例子：网站登录之后，下次不用再登录；第二次访问直接就登录上去了。</p><h4 id="6-8-3-Cookie"><a href="#6-8-3-Cookie" class="headerlink" title="6.8.3 Cookie"></a>6.8.3 Cookie</h4><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/cookie_picture.png" srcset="/img/loading.gif" alt="cookie的处理方式"></p><ol><li><p>从请求中拿到cookie信息</p></li><li><p>服务器响应给客户端cookie</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Cookie[] cookies = req.getCookies(); <span class="hljs-comment">// 获得cookie</span><br>cookie.getName() <span class="hljs-comment">// 获得cookie中的key</span><br>cookie.getValue() <span class="hljs-comment">// 获得cookie中的value</span><br><span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;lastLoginTime&quot;</span>, System.currentTimeMillis() + <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// 新建一个cookie</span><br>cookie.setMaxAge(<span class="hljs-number">24</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>); <span class="hljs-comment">// 设置cookie的有效期</span><br>resp.addCookie(cookie); <span class="hljs-comment">// 响应给客户端一个cookie</span><br></code></pre></td></tr></table></figure></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>    <span class="hljs-comment">// 服务器，告诉你，你来的时间，把这个时间封装成为一个 信件，你下次带来，我就知道你来了</span><br><br>    <span class="hljs-comment">// 解决中文乱码</span><br>    req.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>    resp.setContentType(<span class="hljs-string">&quot;text/html&quot;</span>);<br>    resp.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br><br>    PrintWriter out = resp.getWriter();<br><br>    <span class="hljs-comment">// Cookie，服务器端从客户端获取 这里返回数组，说明Cookie可能存在多个</span><br>    Cookie[] cookies = req.getCookies();<br><br>    <span class="hljs-comment">// 判断Cookie是否存在</span><br>    <span class="hljs-keyword">if</span> (cookies != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">// 如果存在怎么办</span><br>        out.write(<span class="hljs-string">&quot;你上一次访问的时间为：&quot;</span>);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; cookies.length; i++) &#123;<br>            Cookie cookie = cookies[i];<br>            <span class="hljs-comment">// 获取cookie的名字</span><br>            <span class="hljs-keyword">if</span> (cookie.getName().equals(<span class="hljs-string">&quot;lastLoginTime&quot;</span>)) &#123;<br>                <span class="hljs-comment">// 获取cookie中的值</span><br>                <span class="hljs-keyword">long</span> lastLoginTime = Long.parseLong(cookie.getValue());<br>                Date date = <span class="hljs-keyword">new</span> Date(lastLoginTime);<br>                out.write(date.toLocaleString());<br>            &#125;<br>        &#125;<br><br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        out.write(<span class="hljs-string">&quot;这是您第一次访问本站&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 服务器给客户端响应一个cookie</span><br>    Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;lastLoginTime&quot;</span>, System.currentTimeMillis() + <span class="hljs-string">&quot;&quot;</span>);<br>    <span class="hljs-comment">// cookie有效期为1天 浏览器关掉后cookie仍然存在</span><br>    cookie.setMaxAge(<span class="hljs-number">24</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>);<br>    resp.addCookie(cookie);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>浏览器里的Application</strong></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/browser_application_cookie.png" srcset="/img/loading.gif" alt="浏览器Application里的cookie"></p><p><strong>请求和响应中的cookie</strong></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/browser_network_cookie.png" srcset="/img/loading.gif" alt="浏览器抓包中的cookie"></p><p><strong>cookie</strong>:<strong>一般会保存在本地的用户目录下AppData</strong></p><p><strong>思考</strong>：一个网站cookie是否存在上限？<strong>细节问题</strong></p><ul><li>一个cookie只能保存一个信息</li><li>一个web站点可以给浏览器发送多个cookie，最多存放20个cookie</li><li>cookie大小有限制4kb</li><li>300个cookie为浏览器上限</li></ul><p><strong>删除cookie</strong>：</p><ul><li>不设置<strong>有效期</strong> cookie.setMaxAge()</li><li>设置有效期时间为 0，</li></ul><p><strong>设置cookie和取cookie时的编码和解码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;name&quot;</span>, URLEncoder.encode(<span class="hljs-string">&quot;乔威&quot;</span>,<span class="hljs-string">&quot;utf-8&quot;</span>));<br>out.write(URLDecoder.decode(cookie.getValue(),<span class="hljs-string">&quot;utf-8&quot;</span>));<br></code></pre></td></tr></table></figure><h4 id="6-8-4-Session（重点）"><a href="#6-8-4-Session（重点）" class="headerlink" title="6.8.4 Session（重点）"></a>6.8.4 Session（重点）</h4><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/session_picture.png" srcset="/img/loading.gif" alt="session的处理"></p><p>什么是Session：</p><ul><li><p>服务器会给<strong>每一个用户（浏览器）</strong>创建一个Session对象</p></li><li><p>一个Session独占一个浏览器，只要浏览器没有关闭，这个Seesion就存在；</p></li><li><p>用户登录之后，整个网站它都可以访问。—&gt;保存用户的信息；保存购物车的信息</p></li></ul><p><img src="JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%5ChttpSession_methods.png" srcset="/img/loading.gif" alt="httpSession方法"></p><p><strong>Session和Cookie的区别</strong>：</p><ul><li><p>Cookie是把用户的数据写给用户的浏览器，浏览器保存（可以保存多个，理解为通行证）</p></li><li><p>Session把用户的数据写到用户独占的Session中，服务器端保存（保存重要的信息，减少服务器资源的浪费，理解为用户信息）</p></li><li><p>Session对象由服务器创建</p></li></ul><p><strong>Session使用场景</strong>：</p><ul><li><p>保存一个登陆用户的信息</p></li><li><p>购物车信息；</p></li><li><p>在整个网站中经常会使用的数据，我们将它保存在Session中</p></li></ul><p><strong>使用Session</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>    <span class="hljs-comment">// 解决乱码问题</span><br>    resp.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>    req.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>    resp.setContentType(<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>);<br><br>    <span class="hljs-comment">// 得到Session</span><br>    HttpSession session = req.getSession();<br><br>    <span class="hljs-comment">// 给Session中存信息</span><br>    session.setAttribute(<span class="hljs-string">&quot;personInfo&quot;</span>, <span class="hljs-keyword">new</span> Person(<span class="hljs-string">&quot;乔威&quot;</span>, <span class="hljs-number">20</span>));<br><br>    <span class="hljs-comment">// 获取Session的ID</span><br>    String sessionId = session.getId();<br><br>    <span class="hljs-comment">// 判断Session是不是新创建的</span><br>    <span class="hljs-keyword">if</span> (session.isNew()) &#123;<br>        resp.getWriter().write(<span class="hljs-string">&quot;session创建成功，ID：&quot;</span> + sessionId);<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        resp.getWriter().write(<span class="hljs-string">&quot;session已经在服务器中存在了，ID：&quot;</span> + sessionId);<br>    &#125;<br><br>    <span class="hljs-comment">// Session创建的时候做了什么事情;</span><br>    <span class="hljs-comment">//        Cookie cookie = new Cookie(&quot;JSESSIONID&quot;, sessionId);</span><br>    <span class="hljs-comment">//        resp.addCookie(cookie);</span><br><br>    <span class="hljs-comment">// Session在浏览器打开的一瞬间就存在了，关闭时自动消失，不需要像Cookie一样手动addCookie</span><br>&#125;<br><br><span class="hljs-comment">// 得到Session</span><br>        HttpSession session = req.getSession();<br><br>        Person person = (Person) session.getAttribute(<span class="hljs-string">&quot;personInfo&quot;</span>);<br><br>        System.out.println(person.toString());<br><br><span class="hljs-comment">// 手动注销Session</span><br>        session.invalidate();<br></code></pre></td></tr></table></figure><p>会话自动过期：在web.xml中设置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--设置Session默认的失效时间--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">session-config</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--一天后Session自动失效，以分钟为单位--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">session-timeout</span>&gt;</span>1440<span class="hljs-tag">&lt;/<span class="hljs-name">session-timeout</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">session-config</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="7-JSP"><a href="#7-JSP" class="headerlink" title="7. JSP"></a>7. JSP</h2><h3 id="7-1-什么是JSP"><a href="#7-1-什么是JSP" class="headerlink" title="7.1 什么是JSP"></a>7.1 什么是JSP</h3><p>Java Server Pages：Java服务器端页面，也和Servlet一样，用于开发动态web</p><p>最大的特点：</p><ul><li>写JSP就像在写HTML</li><li>区别：<ul><li>HTML只给用户提供静态的数据</li><li>JSP页面中可以嵌入JAVA代码，为用户提供动态数据</li></ul></li></ul><h3 id="7-2-JSP原理"><a href="#7-2-JSP原理" class="headerlink" title="7.2 JSP原理"></a>7.2 JSP原理</h3><p><strong>思路</strong>：JSP到底是如何执行的？</p><ul><li><p>代码层面没有任何问题</p></li><li><p>服务器内部工作</p><p>tomcat中有一个work目录：</p><p>IDEA中使用Tomcat的话，会在IDEA的Tomcat中生成一个work目录</p><p>在我的电脑的目录：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">C:\Users\M\AppData\Local\JetBrains\IntelliJIdea2020<span class="hljs-number">.1</span>\tomcat\Tomcat_9_0_41_javaweb<span class="hljs-number">-02</span>-servlet\work\Catalina\localhost\requestTest_war\org\apache\jsp<br></code></pre></td></tr></table></figure><p>发现页面转变成了java程序</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/jsp_work.png" srcset="/img/loading.gif" alt="页面变为了java程序"></p><p><strong>浏览器向服务器发送请求，不管访问什么资源，其实都是在访问Servlet!</strong></p><p>服务器在执行jsp的时候，首先把jsp翻译成一个Servlet，所以我们访问jsp时，其实不是在访问jsp，而是在访问jsp翻译过后的那个Servlet，例如下面的代码：</p><p><strong>index.jsp</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page language=<span class="hljs-string">&quot;java&quot;</span> <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.*&quot;</span> pageEncoding=<span class="hljs-string">&quot;UTF-8&quot;</span>%&gt;<br>&lt;%<br>String path = request.getContextPath();<br>String basePath = request.getScheme()+<span class="hljs-string">&quot;://&quot;</span>+request.getServerName()+<span class="hljs-string">&quot;:&quot;</span>+request.getServerPort()+path+<span class="hljs-string">&quot;/&quot;</span>;<br>%&gt;<br><br>&lt;!DOCTYPE HTML PUBLIC <span class="hljs-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;<br>&lt;html&gt;<br>  &lt;head&gt;<br>    &lt;base href=<span class="hljs-string">&quot;&lt;%=basePath%&gt;&quot;</span>&gt;<br><br>    &lt;title&gt;First Jsp&lt;/title&gt;<br><br>  &lt;/head&gt;<br><br>  &lt;body&gt;<br>    &lt;%<br>        out.print(<span class="hljs-string">&quot;Hello Jsp&quot;</span>);<br>    %&gt;<br>  &lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>当我们通过浏览器访问index.jsp时，服务器首先将index.jsp翻译成一个index_jsp.class，在Tomcat服务器的<strong>work\Catalina\localhost\项目名\org\apache\jsp</strong>目录下可以看到index_jsp.class的源代码文件index_jsp.java，index_jsp.java的代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.apache.jsp;<br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> javax.servlet.http.*;<br><span class="hljs-keyword">import</span> javax.servlet.jsp.*;<br><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">index_jsp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">org</span>.<span class="hljs-title">apache</span>.<span class="hljs-title">jasper</span>.<span class="hljs-title">runtime</span>.<span class="hljs-title">HttpJspBase</span></span><br><span class="hljs-class">    <span class="hljs-keyword">implements</span> <span class="hljs-title">org</span>.<span class="hljs-title">apache</span>.<span class="hljs-title">jasper</span>.<span class="hljs-title">runtime</span>.<span class="hljs-title">JspSourceDependent</span> </span>&#123;<br><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> JspFactory _jspxFactory = JspFactory.getDefaultFactory();<br><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> java.util.List _jspx_dependants;<br><br>  <span class="hljs-keyword">private</span> javax.el.ExpressionFactory _el_expressionfactory;<br>  <span class="hljs-keyword">private</span> org.apache.AnnotationProcessor _jsp_annotationprocessor;<br><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getDependants</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> _jspx_dependants;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">_jspInit</span><span class="hljs-params">()</span> </span>&#123;<br>    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();<br>    _jsp_annotationprocessor = (org.apache.AnnotationProcessor) getServletConfig().getServletContext().getAttribute(org.apache.AnnotationProcessor.class.getName());<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">_jspDestroy</span><span class="hljs-params">()</span> </span>&#123;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">_jspService</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> java.io.IOException, ServletException </span>&#123;<br><br>    PageContext pageContext = <span class="hljs-keyword">null</span>;<br>    HttpSession session = <span class="hljs-keyword">null</span>;<br>    ServletContext application = <span class="hljs-keyword">null</span>;<br>    ServletConfig config = <span class="hljs-keyword">null</span>;<br>    JspWriter out = <span class="hljs-keyword">null</span>;<br>    Object page = <span class="hljs-keyword">this</span>;<br>    JspWriter _jspx_out = <span class="hljs-keyword">null</span>;<br>    PageContext _jspx_page_context = <span class="hljs-keyword">null</span>;<br><br><br>    <span class="hljs-keyword">try</span> &#123;<br>      response.setContentType(<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span>);<br>      pageContext = _jspxFactory.getPageContext(<span class="hljs-keyword">this</span>, request, response,<br>                  <span class="hljs-keyword">null</span>, <span class="hljs-keyword">true</span>, <span class="hljs-number">8192</span>, <span class="hljs-keyword">true</span>);<br>      _jspx_page_context = pageContext;<br>      application = pageContext.getServletContext();<br>      config = pageContext.getServletConfig();<br>      session = pageContext.getSession();<br>      out = pageContext.getOut();<br>      _jspx_out = out;<br><br>      out.write(<span class="hljs-string">&#x27;\r&#x27;</span>);<br>      out.write(<span class="hljs-string">&#x27;\n&#x27;</span>);<br><br>String path = request.getContextPath();<br>String basePath = request.getScheme()+<span class="hljs-string">&quot;://&quot;</span>+request.getServerName()+<span class="hljs-string">&quot;:&quot;</span>+request.getServerPort()+path+<span class="hljs-string">&quot;/&quot;</span>;<br><br>      out.write(<span class="hljs-string">&quot;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 4.01 Transitional//EN\&quot;&gt;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;&lt;html&gt;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;  &lt;head&gt;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;    &lt;base href=\&quot;&quot;</span>);<br>      out.print(basePath);<br>      out.write(<span class="hljs-string">&quot;\&quot;&gt;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;    \r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;    &lt;title&gt;First Jsp&lt;/title&gt;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;\t\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;  &lt;/head&gt;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;  \r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;  &lt;body&gt;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;    &quot;</span>);<br><br>        out.print(<span class="hljs-string">&quot;Hello Jsp&quot;</span>);<br><br>      out.write(<span class="hljs-string">&quot;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;  &lt;/body&gt;\r\n&quot;</span>);<br>      out.write(<span class="hljs-string">&quot;&lt;/html&gt;\r\n&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>      <span class="hljs-keyword">if</span> (!(t <span class="hljs-keyword">instanceof</span> SkipPageException))&#123;<br>        out = _jspx_out;<br>        <span class="hljs-keyword">if</span> (out != <span class="hljs-keyword">null</span> &amp;&amp; out.getBufferSize() != <span class="hljs-number">0</span>)<br>          <span class="hljs-keyword">try</span> &#123; out.clearBuffer(); &#125; <span class="hljs-keyword">catch</span> (java.io.IOException e) &#123;&#125;<br>        <span class="hljs-keyword">if</span> (_jspx_page_context != <span class="hljs-keyword">null</span>) _jspx_page_context.handlePageException(t);<br>      &#125;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>      _jspxFactory.releasePageContext(_jspx_page_context);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>我们可以看到，index_jsp这个类是继承 org.apache.jasper.runtime.<strong>HttpJspBase</strong>这个类的</p><p>通过导入Jasper Runtime包拿到了这个类，发现它的源码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="hljs-comment">// (powered by Fernflower decompiler)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-keyword">package</span> org.apache.jasper.runtime;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> javax.servlet.ServletConfig;<br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.servlet.jsp.HttpJspPage;<br><span class="hljs-keyword">import</span> javax.servlet.jsp.JspFactory;<br><span class="hljs-keyword">import</span> org.apache.commons.logging.LogFactory;<br><span class="hljs-keyword">import</span> org.apache.jasper.compiler.Localizer;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpJspBase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HttpJspPage</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">HttpJspBase</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(ServletConfig config)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>        <span class="hljs-keyword">super</span>.init(config);<br>        <span class="hljs-keyword">this</span>.jspInit();<br>        <span class="hljs-keyword">this</span>._jspInit();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getServletInfo</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Localizer.getMessage(<span class="hljs-string">&quot;jsp.engine.info&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.jspDestroy();<br>        <span class="hljs-keyword">this</span>._jspDestroy();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-keyword">this</span>._jspService(request, response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">jspInit</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">_jspInit</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">jspDestroy</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">_jspDestroy</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">_jspService</span><span class="hljs-params">(HttpServletRequest var1, HttpServletResponse var2)</span> <span class="hljs-keyword">throws</span> ServletException, IOException</span>;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">if</span> (JspFactory.getDefaultFactory() == <span class="hljs-keyword">null</span>) &#123;<br>            JspFactoryImpl factory = <span class="hljs-keyword">new</span> JspFactoryImpl();<br>            <span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-keyword">null</span>) &#123;<br>                String basePackage = <span class="hljs-string">&quot;org.apache.jasper.&quot;</span>;<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    factory.getClass().getClassLoader().loadClass(basePackage + <span class="hljs-string">&quot;runtime.JspFactoryImpl$PrivilegedGetPageContext&quot;</span>);<br>                    factory.getClass().getClassLoader().loadClass(basePackage + <span class="hljs-string">&quot;runtime.JspFactoryImpl$PrivilegedReleasePageContext&quot;</span>);<br>                    factory.getClass().getClassLoader().loadClass(basePackage + <span class="hljs-string">&quot;runtime.JspRuntimeLibrary&quot;</span>);<br>                    factory.getClass().getClassLoader().loadClass(basePackage + <span class="hljs-string">&quot;runtime.JspRuntimeLibrary$PrivilegedIntrospectHelper&quot;</span>);<br>                    factory.getClass().getClassLoader().loadClass(basePackage + <span class="hljs-string">&quot;runtime.ServletResponseWrapperInclude&quot;</span>);<br>                    factory.getClass().getClassLoader().loadClass(basePackage + <span class="hljs-string">&quot;servlet.JspServletWrapper&quot;</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var3) &#123;<br>                    LogFactory.getLog(HttpJspBase.class).error(<span class="hljs-string">&quot;Jasper JspRuntimeContext preload of class failed: &quot;</span> + var3.getMessage(), var3);<br>                &#125;<br>            &#125;<br><br>            JspFactory.setDefaultFactory(factory);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>我们发现HttpJspBase类是继承于HttpServlet的，所以HttpJspBase类也是一个Servlet，而index_jsp又是继承HttpJspBase类的，所以index_jsp类也是一个Servlet；</p><p>对比index_jsp.java和index.jsp 发现其中的标签最终在index_jsp.java中都是用out.write()方法手动去实现的，如下图所示：</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/jsp_work_compare.png" srcset="/img/loading.gif" alt="对比图"></p></li></ul><p>所以说：<strong>JSP本质上就是一个Servlet！</strong></p><p>我们从index_jsp.java中的一些方法可以更深刻的体会这一点</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 初始化</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">_jspInit</span><span class="hljs-params">()</span> </span>&#123;<br>  &#125;<br><span class="hljs-comment">// 销毁</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">_jspDestroy</span><span class="hljs-params">()</span> </span>&#123;<br>  &#125;<br><span class="hljs-comment">// JSPService</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">_jspService</span><span class="hljs-params">(<span class="hljs-keyword">final</span> javax.servlet.http.HttpServletRequest request, <span class="hljs-keyword">final</span> javax.servlet.http.HttpServletResponse response)</span></span><br></code></pre></td></tr></table></figure><p><strong>JSP又做了什么事情呢</strong>？(即讲解JspService方法中的内容)</p><ol><li><p>判断请求</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) &#123;<br>    <span class="hljs-keyword">final</span> java.lang.String _jspx_method = request.getMethod();<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;OPTIONS&quot;</span>.equals(_jspx_method)) &#123;<br>        response.setHeader(<span class="hljs-string">&quot;Allow&quot;</span>,<span class="hljs-string">&quot;GET, HEAD, POST, OPTIONS&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;GET&quot;</span>.equals(_jspx_method) &amp;&amp; !<span class="hljs-string">&quot;POST&quot;</span>.equals(_jspx_method) &amp;&amp; !<span class="hljs-string">&quot;HEAD&quot;</span>.equals(_jspx_method)) &#123;<br>        response.setHeader(<span class="hljs-string">&quot;Allow&quot;</span>,<span class="hljs-string">&quot;GET, HEAD, POST, OPTIONS&quot;</span>);<br>        response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, <span class="hljs-string">&quot;JSP 只允许 GET、POST 或 HEAD。Jasper 还允许 OPTIONS&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>内置了一些对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> javax.servlet.jsp.PageContext pageContext; <span class="hljs-comment">// 页面上下文</span><br>javax.servlet.http.HttpSession session = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// session</span><br><span class="hljs-keyword">final</span> javax.servlet.ServletContext application; <span class="hljs-comment">// applicaiton</span><br><span class="hljs-keyword">final</span> javax.servlet.ServletConfig config; <span class="hljs-comment">// config配置</span><br>javax.servlet.jsp.JspWriter out = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// out输出对象</span><br><span class="hljs-keyword">final</span> java.lang.Object page = <span class="hljs-keyword">this</span>; <span class="hljs-comment">// page:</span><br>javax.servlet.jsp.JspWriter _jspx_out = <span class="hljs-keyword">null</span>;<br>javax.servlet.jsp.PageContext _jspx_page_context = <span class="hljs-keyword">null</span>;<br>HttpServletRequest request <span class="hljs-comment">// 请求</span><br>HttpServletResponse response <span class="hljs-comment">// 响应</span><br></code></pre></td></tr></table></figure></li><li><p>输出页面前增加的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">response.setContentType(<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span>); <span class="hljs-comment">// 设置响应的页面类型</span><br>pageContext = _jspxFactory.getPageContext(<span class="hljs-keyword">this</span>, request, response,<br>                                          <span class="hljs-keyword">null</span>, <span class="hljs-keyword">true</span>, <span class="hljs-number">8192</span>, <span class="hljs-keyword">true</span>);<br>_jspx_page_context = pageContext; <br>application = pageContext.getServletContext();<br>config = pageContext.getServletConfig();<br>session = pageContext.getSession();<br>out = pageContext.getOut();<br>_jspx_out = out;<br></code></pre></td></tr></table></figure></li><li><p>以上的这些个对象我们可以在JSP页面中直接使用！</p></li><li><p>JSP原理流程图</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JSP_yuanli.png" srcset="/img/loading.gif" alt="JSP原理流程图"></p></li></ol><h3 id="7-3-JSP基础语法和指令"><a href="#7-3-JSP基础语法和指令" class="headerlink" title="7.3 JSP基础语法和指令"></a>7.3 JSP基础语法和指令</h3><p>任何语言都有自己的语法，JAVA中有，JSP作为java技术的一种应用，它拥有一些自己扩充的语法，java所有语法它都支持。</p><h4 id="7-3-1-JSP表达式"><a href="#7-3-1-JSP表达式" class="headerlink" title="7.3.1 JSP表达式"></a><strong>7.3.1 JSP表达式</strong></h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%--<br>    JSP表达式作用：用来将程序的输出，输出到客户端<br>--%&gt;<br>&lt;%= <span class="hljs-keyword">new</span> java.util.Date()%&gt;<br></code></pre></td></tr></table></figure><h4 id="7-3-2-JSP脚本判断"><a href="#7-3-2-JSP脚本判断" class="headerlink" title="7.3.2 JSP脚本判断"></a><strong>7.3.2 JSP脚本判断</strong></h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%--<br>    JSP脚本片段<br>  --%&gt;<br>&lt;%<br>    <span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i++) &#123;<br>        sum += i;<br>    &#125;<br>    out.println(<span class="hljs-string">&quot;&lt;h1&gt;Sum=&quot;</span> + sum + <span class="hljs-string">&quot;&lt;/h1&gt;&quot;</span>);<br>%&gt;<br></code></pre></td></tr></table></figure><h4 id="7-3-3-脚本片段的再实现"><a href="#7-3-3-脚本片段的再实现" class="headerlink" title="7.3.3 脚本片段的再实现"></a><strong>7.3.3 脚本片段的再实现</strong></h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%<br>    <span class="hljs-keyword">int</span> x = <span class="hljs-number">10</span>;<br>    out.println(x);<br>%&gt;<br>&lt;p&gt;这是一个jsp文档&lt;/p&gt;<br>&lt;%<br>    <span class="hljs-keyword">int</span> y = <span class="hljs-number">20</span>;<br>    out.println(y);<br>%&gt;<br><br>&lt;hr&gt;<br><br>&lt;%--在代码中嵌入HTML元素--%&gt;<br>&lt;%<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br><br><br>    %&gt;<br>&lt;h1&gt;Hello，world &lt;%=i%&gt;&lt;/h1&gt;<br>&lt;%<br>    &#125;<br>%&gt;<br></code></pre></td></tr></table></figure><h4 id="7-3-4-JSP声明"><a href="#7-3-4-JSP声明" class="headerlink" title="7.3.4 JSP声明"></a><strong>7.3.4 JSP声明</strong></h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%!<br>    <span class="hljs-comment">// 静态代码块</span><br>    <span class="hljs-keyword">static</span> &#123;<br>      System.out.println(<span class="hljs-string">&quot;Loading Servlet&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 全局变量</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> globalVar = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">// 全局方法</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">atrox</span><span class="hljs-params">()</span> </span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;进入了方法atrox！&quot;</span>);<br>    &#125;<br>%&gt;<br></code></pre></td></tr></table></figure><p>JSP声明：会被编译到JSP生成Java的类中！如下图所示：</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JSP%E5%A3%B0%E6%98%8E.png" srcset="/img/loading.gif" alt="JSP声明"></p><p>其他的，就会被生成到_jspService方法中！如下图所示：</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%5CJSP%E5%85%B6%E4%BB%96%E4%B8%9C%E8%A5%BF.png" srcset="/img/loading.gif" alt="JSP其他东西"></p><p>在JSP中，嵌入java代码即可！</p><h4 id="7-3-5-EL表达式"><a href="#7-3-5-EL表达式" class="headerlink" title="7.3.5 EL表达式"></a><strong>7.3.5 EL表达式</strong></h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;h1&gt;Hello，world $&#123;i&#125;&gt;&lt;/h1&gt;<br></code></pre></td></tr></table></figure><h4 id="7-3-6-注释问题"><a href="#7-3-6-注释问题" class="headerlink" title="7.3.6 注释问题"></a>7.3.6 注释问题</h4><p>JSP的注释不会再客户端显示，而HTML就会！</p><p>在index.jsp中写上如下注释：</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%--我是jsp注释--%&gt;<br>&lt;!--我是html注释--&gt;<br></code></pre></td></tr></table></figure><p>在浏览器中右键点击查看源代码，发现html注释还在，所有的jsp注释全部都看不到，但是抓包仍然能看到jsp的注释。</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/jsp_comment.png" srcset="/img/loading.gif" alt="客户端jsp注释不会显示"></p><h3 id="7-4-JSP指令"><a href="#7-4-JSP指令" class="headerlink" title="7.4 JSP指令"></a>7.4 JSP指令</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page args... %&gt;<br>&lt;%@ include<br>    <br>&lt;%--<span class="hljs-meta">@include</span>会将两个从外面引入的页面合二为一--%&gt;<br>&lt;%<span class="hljs-meta">@include</span> file=<span class="hljs-string">&quot;common/header.jsp&quot;</span>%&gt;<br>&lt;h1&gt;网页主体&lt;/h1&gt;<br>&lt;%<span class="hljs-meta">@include</span> file=<span class="hljs-string">&quot;common/footer.jsp&quot;</span>%&gt;<br><br>&lt;%--jsp标签--%&gt;<br>&lt;%--jsp:include：拼接页面，本质还是三个--%&gt;<br>&lt;jsp:include page=<span class="hljs-string">&quot;common/header.jsp&quot;</span>/&gt;<br>&lt;h1&gt;网页主体&lt;/h1&gt;<br>&lt;jsp:include page=<span class="hljs-string">&quot;common/footer.jsp&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h3 id="7-5-九大内置对象"><a href="#7-5-九大内置对象" class="headerlink" title="7.5 九大内置对象"></a>7.5 九大内置对象</h3><p>写了一个JSP页面，服务器一跑会变成一个.java文件，最后变成一个.class文件，变成class文件的时候会自动创建九个内置对象。</p><ul><li>PageContext 存东西</li><li>Resquest 存东西</li><li>Response</li><li>Session 存东西</li><li>Application【ServletContext】存东西</li><li>config【ServletConfig】</li><li>out</li><li>page ，不用</li><li>exception</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%<br>       <span class="hljs-comment">// 从底层到高层（作用域）：page-&gt;request-&gt;session-application</span><br>       <span class="hljs-comment">// 类比于JVM：双亲委派机制：</span><br>       pageContext.setAttribute(<span class="hljs-string">&quot;name1&quot;</span>, <span class="hljs-string">&quot;乔威1号&quot;</span>); <span class="hljs-comment">// 保存的数据只在一个页面中有效</span><br>       request.setAttribute(<span class="hljs-string">&quot;name2&quot;</span>, <span class="hljs-string">&quot;乔威2号&quot;</span>); <span class="hljs-comment">// 保存的数据只在一次请求中有效，请求转发会携带这个数据</span><br>       session.setAttribute(<span class="hljs-string">&quot;name3&quot;</span>, <span class="hljs-string">&quot;乔威3号&quot;</span>); <span class="hljs-comment">// 保存的数据只在一次会话中有效，从打开浏览器到关闭浏览器</span><br>       application.setAttribute(<span class="hljs-string">&quot;name4&quot;</span>, <span class="hljs-string">&quot;乔威4号&quot;</span>); <span class="hljs-comment">// 保存的数据在服务器中有效，从打开服务器到关闭服务器</span><br>   %&gt;<br></code></pre></td></tr></table></figure><p>request：客户端向服务器发送请求，产生的数据，用户看玩就没用了，比如：新闻。</p><p>session：客户端向服务器发送请求，产生的数据，用户用完一会还有用，比如：购物车；</p><p>application：客户端向服务器发送请求，产生的数据，一个用户用完其他用户还可能用，比如：聊天数据；</p><h3 id="7-6-JSP标签、JSTL标签、EL表达式"><a href="#7-6-JSP标签、JSTL标签、EL表达式" class="headerlink" title="7.6 JSP标签、JSTL标签、EL表达式"></a>7.6 JSP标签、JSTL标签、EL表达式</h3><p>需要导包：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--JSTL表达式的依赖--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet.jsp.jstl<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jstl-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--standard标签库--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>taglibs<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>standard<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="7-6-1-EL表达式："><a href="#7-6-1-EL表达式：" class="headerlink" title="7.6.1 EL表达式："></a>7.6.1 EL表达式：</h4><ul><li><strong>获取数据</strong></li><li><strong>执行运算</strong></li><li><strong>获取web开发的常用对象</strong></li><li><del>调用java方法</del></li></ul><h4 id="7-6-2-JSP标签"><a href="#7-6-2-JSP标签" class="headerlink" title="7.6.2 JSP标签"></a><strong>7.6.2 JSP标签</strong></h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%--&lt;jsp:include page=&quot;&quot;&gt;&lt;/jsp:include&gt;--%&gt;<br><br>&lt;jsp:forward page=<span class="hljs-string">&quot;jsptag2.jsp&quot;</span>&gt;<br>    &lt;jsp:param name=<span class="hljs-string">&quot;name&quot;</span> value=<span class="hljs-string">&quot;qiaowei&quot;</span>/&gt;<br>    &lt;jsp:param name=<span class="hljs-string">&quot;age&quot;</span> value=<span class="hljs-string">&quot;20&quot;</span>/&gt;<br>&lt;/jsp:forward&gt;<br></code></pre></td></tr></table></figure><h4 id="7-6-3-JSTL表达式"><a href="#7-6-3-JSTL表达式" class="headerlink" title="7.6.3 JSTL表达式"></a><strong>7.6.3 JSTL表达式</strong></h4><p><strong>JSTL标签库的使用就是为了弥补HTML标签的不足；</strong>它自定义了许多的标签，可以供我们使用，标签的功能和java代码一样。</p><p><strong>格式化标签</strong></p><p><strong>SQL标签</strong></p><p><strong>XML标签</strong></p><p><strong>核心标签</strong>（掌握部分）</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JSTL_core_tag.png" srcset="/img/loading.gif" alt="JSTL核心标签"></p><p><strong>JSTL标签库使用步骤</strong>：</p><ul><li><p>引用对应的taglib</p></li><li><p>使用其中给的方法</p></li><li><p>在Tomcat中也需要手动引入jstl的包到lib目录下，否则会报错：JSTL解析错误</p><p><img src="/JavaWeb%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94%E2%80%94/jstl_tomcat_lib.png" srcset="/img/loading.gif" alt="手动导包"></p><p><strong>测试Demo</strong>：</p></li></ul><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;h4&gt;if测试&lt;/h4&gt;<br><br>&lt;form action=<span class="hljs-string">&quot;coreif.jsp&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span>&gt;<br>    &lt;%--<br>        EL表达式获取表单中的数据<br>        $&#123;param.参数名&#125;<br>    --%&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;userName&quot;</span> value=<span class="hljs-string">&quot;$&#123;param.userName&#125;&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;登录&quot;</span>&gt;<br>&lt;/form&gt;<br><br>&lt;%--判断如果提交的用户名是管理员，则登录成功--%&gt;<br>&lt;c:<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;$&#123;param.userName==&#x27;admin&#x27;&#125;&quot;</span> <span class="hljs-keyword">var</span>=<span class="hljs-string">&quot;isAdmin&quot;</span>&gt;<br>    &lt;c:out value=<span class="hljs-string">&quot;管理员欢迎你!&quot;</span>/&gt;<br>&lt;/c:if&gt;<br>&lt;c:out value=<span class="hljs-string">&quot;$&#123;isAdmin&#125;&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p><strong>效果</strong>：</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/core_tag_demo.png" srcset="/img/loading.gif" alt="测试效果"></p><p><strong>测试c:foreach</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%<br>    ArrayList&lt;String&gt; people = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>    people.add(<span class="hljs-string">&quot;张三&quot;</span>);<br>    people.add(<span class="hljs-string">&quot;李四&quot;</span>);<br>    people.add(<span class="hljs-string">&quot;王五&quot;</span>);<br>    people.add(<span class="hljs-string">&quot;赵六&quot;</span>);<br>    people.add(<span class="hljs-string">&quot;田七&quot;</span>);<br>    request.setAttribute(<span class="hljs-string">&quot;list&quot;</span>,people);<br>%&gt;<br><br>&lt;%--<br><span class="hljs-keyword">var</span>，每一次遍历出来的变量名<br>items，要遍历的对象本身<br>--%&gt;<br>&lt;c:forEach <span class="hljs-keyword">var</span>=<span class="hljs-string">&quot;people&quot;</span> items=<span class="hljs-string">&quot;$&#123;list&#125;&quot;</span>&gt;<br>    &lt;c:out value=<span class="hljs-string">&quot;$&#123;people&#125;&quot;</span>/&gt; &lt;br&gt;<br>&lt;/c:forEach&gt;<br><br>&lt;hr&gt;<br><br>&lt;c:forEach <span class="hljs-keyword">var</span>=<span class="hljs-string">&quot;people&quot;</span> items=<span class="hljs-string">&quot;$&#123;list&#125;&quot;</span> begin=<span class="hljs-string">&quot;1&quot;</span> end=<span class="hljs-string">&quot;3&quot;</span> step=<span class="hljs-string">&quot;2&quot;</span>&gt;<br>    &lt;c:out value=<span class="hljs-string">&quot;$&#123;people&#125;&quot;</span>/&gt; &lt;br&gt;<br>&lt;/c:forEach&gt;<br></code></pre></td></tr></table></figure><p><strong>结果</strong>：</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%5Cjstl_tag_foreach.png" srcset="/img/loading.gif" alt="测试结果"></p><h2 id="8-JavaBean"><a href="#8-JavaBean" class="headerlink" title="8. JavaBean"></a>8. JavaBean</h2><p>通常把JavaBean称为实体类；</p><p>JavaBean有特定的写法：</p><ul><li>必须有一个无参构造</li><li>属性必须私有化</li><li>必须有对应的get/set方法；</li></ul><p>一般用来和数据库的字段做映射 ORM；</p><p>ORM：对象关系映射</p><ul><li>表–&gt;类</li><li>字段–&gt;属性</li><li>行记录—&gt;对象</li></ul><table><thead><tr><th>id</th><th>name</th><th>age</th><th>address</th></tr></thead><tbody><tr><td>1</td><td>乔威1号</td><td>10</td><td>1号路</td></tr><tr><td>2</td><td>乔威2号</td><td>20</td><td>2号路</td></tr><tr><td>3</td><td>乔威3号</td><td>30</td><td>3号路</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">People</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;<br>    <span class="hljs-keyword">private</span> String address;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br>    <span class="hljs-keyword">new</span> People(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;乔威1号&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&quot;1号路&quot;</span>);<br>    <span class="hljs-keyword">new</span> People(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;乔威2号&quot;</span>, <span class="hljs-number">20</span>, <span class="hljs-string">&quot;2号路&quot;</span>);<br>    <span class="hljs-keyword">new</span> People(<span class="hljs-number">3</span>, <span class="hljs-string">&quot;乔威3号&quot;</span>, <span class="hljs-number">30</span>, <span class="hljs-string">&quot;3号路&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="9-MVC三层架构"><a href="#9-MVC三层架构" class="headerlink" title="9.  MVC三层架构"></a>9. MVC三层架构</h2><p>什么是MVC：Model View Controller 模型 视图 控制器</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/mvc.png" srcset="/img/loading.gif" alt="早年的MVC架构"></p><p>用户直接访问控制层，控制层就可以直接操作数据库；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">servlet--CRUD--数据库<br>弊端：程序十分臃肿、不利于维护 servlet的代码中:处理请求、响应、试图跳转、处理JDBC、处理业务代码、处理逻辑代码<br>    <br>架构：没有什么是加一层处理不了的！<br>程序员调用<br>    <br>JDBC<br>    <br>Mysql Oracle SqlServer...<br></code></pre></td></tr></table></figure><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/mvc_structure.png" srcset="/img/loading.gif" alt="mvc架构"></p><p>Model</p><ul><li>业务处理：业务逻辑（Service）</li><li>数据持久层：CRUD（DAO）</li></ul><p>View</p><ul><li>展示数据</li><li>提供链接发起Servlet请求（a，form，img）</li></ul><p>Controller</p><ul><li><p>接受用户的请求：（req：请求参数、Session信息…）</p></li><li><p>交给业务层处理对应的代码</p></li><li><p>控制视图的跳转</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">登录---&gt;接收用户的登录请求---&gt;处理用户的请求（获取用户登陆的参数，username，password）---&gt;交给业务层处理登录业务（判断用户名密码是否正确：事务）---&gt;DAO层查询用户名和密码是否匹配---&gt;操作数据库<br></code></pre></td></tr></table></figure></li></ul><h2 id="10-Fileter过滤器（重点）"><a href="#10-Fileter过滤器（重点）" class="headerlink" title="10. Fileter过滤器（重点）"></a>10. Fileter过滤器（重点）</h2><p>Filter：过滤器，用来过滤网站的数据；</p><ul><li>处理中文乱码</li><li>登录验证</li></ul><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/filter.png" srcset="/img/loading.gif" alt="过滤器流程"></p><h3 id="10-1-filter开发步骤"><a href="#10-1-filter开发步骤" class="headerlink" title="10.1 filter开发步骤"></a>10.1 filter开发步骤</h3><ol><li><p>导包</p></li><li><p>编写过滤器（此处以过滤中文编码为例子），实现Filter接口，重写对应方法</p><ul><li><p>导包不要错（选java.servlet下的）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.servlet.*;<br></code></pre></td></tr></table></figure></li><li><p>编写过滤器的初始状态</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CharacterEncodingFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;<br><br>    <span class="hljs-comment">// 初始化</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;CharacterEncodingFilter初始化&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">// 销毁</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;CharacterEncodingFilter销毁&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>过滤器最终代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CharacterEncodingFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;<br><br>    <span class="hljs-comment">// 初始化：web服务器启动，就已经初始化了，随时等待过滤对象出现</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;CharacterEncodingFilter初始化&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// Chain：链</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    1.过滤器中的所有代码，在过滤特定请求的时候都会执行</span><br><span class="hljs-comment">    2.必须要让过滤器继续通行  filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br>        servletRequest.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>        servletResponse.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>        servletResponse.setContentType(<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span>);<br><br>        System.out.println(<span class="hljs-string">&quot;CharacterEncodingFilter执行前...&quot;</span>);<br>        <span class="hljs-comment">// 让我们的请求继续走，如果不写，程序到这里就被拦截停止</span><br>        filterChain.doFilter(servletRequest,servletResponse);<br>        System.out.println(<span class="hljs-string">&quot;CharacterEncodingFilter执行后...&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 销毁：web服务器关闭的时候，过滤器会销毁</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;CharacterEncodingFilter销毁&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>在web.xml中配置Filter</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>com.atrox.filter.CharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--只要是/servlet下的任何请求，都会经过这个过滤器--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/servlet/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="11-监听器"><a href="#11-监听器" class="headerlink" title="11.监听器"></a>11.监听器</h2><p>实现一个监听器的接口;（有N中）</p><ol><li><p>编写一个监听器</p><p>实现监听器的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atrox.listener;<br><br><span class="hljs-keyword">import</span> javax.servlet.ServletContext;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSessionEvent;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSessionListener;<br><br><span class="hljs-comment">// 统计网站在线人数：统计session</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OnlineCountListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HttpSessionListener</span> </span>&#123;<br><br>    <span class="hljs-comment">// 创建session监听</span><br>    <span class="hljs-comment">// 一旦创建一个Session就会触发一次这个事件！</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sessionCreated</span><span class="hljs-params">(HttpSessionEvent httpSessionEvent)</span> </span>&#123;<br>        ServletContext ctx = httpSessionEvent.getSession().getServletContext();<br>        Integer onlineCount = (Integer) ctx.getAttribute(<span class="hljs-string">&quot;OnlineCount&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (onlineCount == <span class="hljs-keyword">null</span>) &#123;<br>            onlineCount = <span class="hljs-keyword">new</span> Integer(<span class="hljs-number">1</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">int</span> count = onlineCount.intValue();<br>            onlineCount = <span class="hljs-keyword">new</span> Integer(count + <span class="hljs-number">1</span>);<br>        &#125;<br><br>        ctx.setAttribute(<span class="hljs-string">&quot;OnlineCount&quot;</span>,onlineCount);<br>    &#125;<br><br>    <span class="hljs-comment">// 销毁session监听</span><br>    <span class="hljs-comment">// 一旦销毁Session就会触发一次这个事件！</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sessionDestroyed</span><span class="hljs-params">(HttpSessionEvent httpSessionEvent)</span> </span>&#123;<br>        ServletContext ctx = httpSessionEvent.getSession().getServletContext();<br>        Integer onlineCount = (Integer) ctx.getAttribute(<span class="hljs-string">&quot;OnlineCount&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (onlineCount == <span class="hljs-keyword">null</span>) &#123;<br>            onlineCount = <span class="hljs-keyword">new</span> Integer(<span class="hljs-number">0</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">int</span> count = onlineCount.intValue();<br>            onlineCount = <span class="hljs-keyword">new</span> Integer(count - <span class="hljs-number">1</span>);<br>        &#125;<br><br>        ctx.setAttribute(<span class="hljs-string">&quot;OnlineCount&quot;</span>, onlineCount);<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    Session销毁：</span><br><span class="hljs-comment">    1.手动销毁 getSession().invalidate()</span><br><span class="hljs-comment">    2.自动销毁 web.xml中sessionConfig标签</span><br><span class="hljs-comment">     */</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>web.xml中注册监听器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!--注册监听器--&gt;<br>    &lt;listener&gt;<br>    &lt;listener-<span class="hljs-class"><span class="hljs-keyword">class</span>&gt;<span class="hljs-title">com</span>.<span class="hljs-title">atrox</span>.<span class="hljs-title">listener</span>.<span class="hljs-title">OnlineCountListener</span>&lt;/<span class="hljs-title">listener</span>-<span class="hljs-title">class</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">listener</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>看情况是否使用</p></li></ol><h2 id="12-过滤器、监听器常见应用"><a href="#12-过滤器、监听器常见应用" class="headerlink" title="12. 过滤器、监听器常见应用"></a>12. 过滤器、监听器常见应用</h2><h3 id="12-1-监听器：GUI编程中经常使用"><a href="#12-1-监听器：GUI编程中经常使用" class="headerlink" title="12.1 监听器：GUI编程中经常使用"></a>12.1 监听器：GUI编程中经常使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestPanel</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Frame frame = <span class="hljs-keyword">new</span> Frame(<span class="hljs-string">&quot;圣诞节快乐&quot;</span>); <span class="hljs-comment">// 新建一个窗体</span><br>        Panel panel = <span class="hljs-keyword">new</span> Panel(<span class="hljs-keyword">null</span>); <span class="hljs-comment">// 面板</span><br>        frame.setLayout(<span class="hljs-keyword">null</span>); <span class="hljs-comment">// 设置窗体的布局</span><br><br>        frame.setBounds(<span class="hljs-number">300</span>,<span class="hljs-number">300</span>,<span class="hljs-number">500</span>,<span class="hljs-number">500</span>);<br>        frame.setBackground(<span class="hljs-keyword">new</span> Color(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">255</span>)); <span class="hljs-comment">// 设置背景颜色</span><br><br>        panel.setBounds(<span class="hljs-number">50</span>,<span class="hljs-number">50</span>,<span class="hljs-number">300</span>,<span class="hljs-number">300</span>);<br>        frame.setBackground(<span class="hljs-keyword">new</span> Color(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>)); <span class="hljs-comment">// 设置背景颜色</span><br><br>        frame.add(panel);<br>        frame.setVisible(<span class="hljs-keyword">true</span>);<br><br>        <span class="hljs-comment">// 监听事件，监听关闭时间</span><br>        frame.addWindowListener(<span class="hljs-keyword">new</span> WindowListener() &#123;<br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">windowOpened</span><span class="hljs-params">(WindowEvent e)</span> </span>&#123;<br>                System.out.println(<span class="hljs-string">&quot;打开&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">windowClosing</span><span class="hljs-params">(WindowEvent e)</span> </span>&#123;<br>                System.out.println(<span class="hljs-string">&quot;关闭ing&quot;</span>);<br>                System.out.println(<span class="hljs-number">0</span>);<br>            &#125;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">windowClosed</span><span class="hljs-params">(WindowEvent e)</span> </span>&#123;<br>                System.out.println(<span class="hljs-string">&quot;关闭ed&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">windowIconified</span><span class="hljs-params">(WindowEvent e)</span> </span>&#123;<br><br>            &#125;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">windowDeiconified</span><span class="hljs-params">(WindowEvent e)</span> </span>&#123;<br><br>            &#125;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">windowActivated</span><span class="hljs-params">(WindowEvent e)</span> </span>&#123;<br>                System.out.println(<span class="hljs-string">&quot;激活&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">windowDeactivated</span><span class="hljs-params">(WindowEvent e)</span> </span>&#123;<br>                System.out.println(<span class="hljs-string">&quot;关闭ed&quot;</span>);<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="12-2-用户登录拦截"><a href="#12-2-用户登录拦截" class="headerlink" title="12.2 用户登录拦截"></a>12.2 用户登录拦截</h3><p>用户登录成功之后才能进入主页，用户注销后就不能进入主页了！</p><ol><li><p>用户登录之后，向Session中放入用户的数据</p></li><li><p>进入主页的时候要判断用户是否已经登录；要求：在过滤器中实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br><br>    HttpServletRequest request = (HttpServletRequest) servletRequest;<br>    HttpServletResponse response = (HttpServletResponse) servletResponse;<br><br>    Object user_session = request.getSession().getAttribute(<span class="hljs-string">&quot;USER_SESSION&quot;</span>);<br>    <span class="hljs-keyword">if</span> (user_session == <span class="hljs-keyword">null</span>) &#123;<br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/error.jsp&quot;</span>);<br>    &#125;<br><br>    filterChain.doFilter(servletRequest,servletResponse);<br><br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="13-JDBC"><a href="#13-JDBC" class="headerlink" title="13.JDBC"></a>13.JDBC</h2><p>什么是JDBC：Java连接数据库</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JDBC.png" srcset="/img/loading.gif" alt="JDBC"></p><p>需要jar包的支持：</p><ul><li>java.sql</li><li>javax.sql</li><li>mysql.connecter-java…连接驱动（必须要导入）</li></ul><h3 id="13-1-实验环境搭建"><a href="#13-1-实验环境搭建" class="headerlink" title="13.1 实验环境搭建"></a><strong>13.1 实验环境搭建</strong></h3><ul><li><p>导入数据库依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--mysql的驱动--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.22<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><ul><li><p>IDEA中连接数据库</p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/idea_connect_db1.png" srcset="/img/loading.gif" alt="连接数据库第一步"></p></li></ul><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/idea_connect_db2.png" srcset="/img/loading.gif" alt="连接数据库第二步"></p><p><img src="/posts/2020/12/31/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/idea_connect_db3.png" srcset="/img/loading.gif" alt="连接数据库第三步"></p><h3 id="13-2-JDBC固定步骤"><a href="#13-2-JDBC固定步骤" class="headerlink" title="13.2 JDBC固定步骤"></a>13.2 JDBC固定步骤</h3><ol><li><p>加载驱动</p></li><li><p>连接数据库，代表数据库</p></li><li><p>向数据库发送SQL的对象Statement：CRUD</p></li><li><p>编写SQL语句</p></li><li><p>执行查询SQL，返回一个ResultSet结果集</p></li><li><p>关闭连接，释放资源，先开后关</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.sql.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestJdbc</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, SQLException </span>&#123;<br>        <span class="hljs-comment">// 配置信息</span><br>        <span class="hljs-comment">// useUnicode=true&amp;characterEncoding=utf-8 解决中文乱码问题</span><br>        String url= <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/jdbc?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT&quot;</span>;<br>        String username = <span class="hljs-string">&quot;root&quot;</span>;<br>        String password = <span class="hljs-string">&quot;zuiweizhiming666&quot;</span>;<br><br>        <span class="hljs-comment">// 1.加载驱动</span><br>        Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br>        <span class="hljs-comment">// 2.连接数据库,代表数据库</span><br>        Connection connection = DriverManager.getConnection(url, username, password);<br>        <span class="hljs-comment">// 3.向数据库发送SQL的对象Statement：CRUD</span><br>        Statement statement = connection.createStatement();<br>        <span class="hljs-comment">// 4.编写SQL</span><br>        String sql = <span class="hljs-string">&quot;select * from users&quot;</span>;<br>        <span class="hljs-comment">// 5.执行查询SQL，返回一个ResultSet结果集</span><br>        ResultSet resultSet = statement.executeQuery(sql);<br><br>        <span class="hljs-keyword">while</span> (resultSet.next()) &#123;<br>            System.out.println(<span class="hljs-string">&quot;id=&quot;</span>+resultSet.getObject(<span class="hljs-string">&quot;id&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;name=&quot;</span>+resultSet.getObject(<span class="hljs-string">&quot;name&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;password=&quot;</span>+resultSet.getObject(<span class="hljs-string">&quot;password&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;email=&quot;</span>+resultSet.getObject(<span class="hljs-string">&quot;email&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;birthday=&quot;</span>+resultSet.getObject(<span class="hljs-string">&quot;birthday&quot;</span>));<br>        &#125;<br><br>        <span class="hljs-comment">// 6.关闭连接，释放资源，先开后关</span><br>        resultSet.close();<br>        statement.close();<br>        connection.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="13-3-预编译SQL"><a href="#13-3-预编译SQL" class="headerlink" title="13.3 预编译SQL"></a>13.3 预编译SQL</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestJDBC2</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, SQLException </span>&#123;<br>        <span class="hljs-comment">// 配置信息</span><br>        <span class="hljs-comment">// useUnicode=true&amp;characterEncoding=utf-8 解决中文乱码问题</span><br>        String url= <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/jdbc?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT&quot;</span>;<br>        String username = <span class="hljs-string">&quot;root&quot;</span>;<br>        String password = <span class="hljs-string">&quot;zuiweizhiming666&quot;</span>;<br><br>        <span class="hljs-comment">// 1.加载驱动</span><br>        Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br>        <span class="hljs-comment">// 2.连接数据库,代表数据库</span><br>        Connection connection = DriverManager.getConnection(url, username, password);<br>        <span class="hljs-comment">// 3.编写SQL</span><br>        String sql = <span class="hljs-string">&quot;insert into users(id,name,password,email,birthday) values (?,?,?,?,?)&quot;</span>;<br>        <span class="hljs-comment">// 4.预编译</span><br>        PreparedStatement preparedStatement = connection.prepareStatement(sql);<br>        preparedStatement.setInt(<span class="hljs-number">1</span>,<span class="hljs-number">4</span>); <span class="hljs-comment">// 给第1个占位符？ 的值赋值为1</span><br>        preparedStatement.setString(<span class="hljs-number">2</span>,<span class="hljs-string">&quot;qiaowei&quot;</span>); <span class="hljs-comment">// 给第2个占位符？ 的值赋值为qiaowei</span><br>        preparedStatement.setString(<span class="hljs-number">3</span>,<span class="hljs-string">&quot;123456&quot;</span>); <span class="hljs-comment">// 给第3个占位符？ 的值赋值为123456</span><br>        preparedStatement.setString(<span class="hljs-number">4</span>,<span class="hljs-string">&quot;qiaowei@qq.com&quot;</span>); <span class="hljs-comment">// 给第4个占位符？ 的值赋值为qiaowei@qq.com</span><br>        preparedStatement.setDate(<span class="hljs-number">5</span>,<span class="hljs-keyword">new</span> Date(System.currentTimeMillis())); <span class="hljs-comment">// 给第5个占位符？ 的值赋值为当前时间</span><br>        <span class="hljs-comment">// 5.执行SQL</span><br>        <span class="hljs-keyword">int</span> i = preparedStatement.executeUpdate();<br>        <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot;插入成功&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// 6.关闭连接，释放资源，先开后关</span><br>      reparedStatement.close();<br>      connection.close();<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="13-4-事务"><a href="#13-4-事务" class="headerlink" title="13.4 事务"></a>13.4 事务</h3><p>要么都成功，要么都失败！</p><p>ACID原则：保证数据的安全</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">开启事务<br>事务提交 commit()<br>事务回滚 rollback()<br>关闭事务<br>    <br>转账：<br>A：<span class="hljs-number">1000</span><br>B：<span class="hljs-number">1000</span><br>    <br>A(<span class="hljs-number">900</span>) ---<span class="hljs-number">100</span>---&gt; B(<span class="hljs-number">1100</span>)<br></code></pre></td></tr></table></figure><p><strong>junit单元测试</strong></p><p>依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>简单使用</p><p>@Test注解只有在方法上有效，只要加了这个注解的方法，就可以直接运行。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;hello&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>实例代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.Test;<br><br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.DriverManager;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 乔威</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-12-25 21:37</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestJDBC3</span> </span>&#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br><br>        <span class="hljs-comment">// 配置信息</span><br>        <span class="hljs-comment">// useUnicode=true&amp;characterEncoding= utf-8 解决中文乱码问题</span><br>        String url= <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/jdbc?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT&quot;</span>;<br>        String username = <span class="hljs-string">&quot;root&quot;</span>;<br>        String password = <span class="hljs-string">&quot;zuiweizhiming666&quot;</span>;<br><br>        Connection connection = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-comment">// 1.加载驱动</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br>            <span class="hljs-comment">// 2.连接数据库,代表数据库</span><br>            connection = DriverManager.getConnection(url, username, password);<br><br>            <span class="hljs-comment">// 3.同志数据库开启事务,false是开启，true是关闭</span><br>            connection.setAutoCommit(<span class="hljs-keyword">false</span>);<br><br>            String sql1 = <span class="hljs-string">&quot;update account set money = money - 100 where name = &#x27;A&#x27;&quot;</span>;<br>            connection.prepareStatement(sql1).executeUpdate();<br><br>            <span class="hljs-comment">// 4.制造错误</span><br><span class="hljs-comment">//            int i = 1 / 0;</span><br><br>            String sql2 = <span class="hljs-string">&quot;update account set money = money + 100 where name = &#x27;B&#x27;&quot;</span>;<br>            connection.prepareStatement(sql2).executeUpdate();<br><br>            connection.commit(); <span class="hljs-comment">//以上两条SQL都提交成功了，就提交事务！</span><br>            System.out.println(<span class="hljs-string">&quot;success&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-comment">// 如果出现异常，就通知数据库回滚害死我</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                connection.rollback();<br>                System.out.println(<span class="hljs-string">&quot;error！&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>                throwables.printStackTrace();<br>            &#125;<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                connection.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>                throwables.printStackTrace();<br>            &#125;<br>        &#125;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas mb-3"></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/posts/2020/12/31/fluid%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">fluid主题配置</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/posts/2020/12/31/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="hidden-mobile">MyBatis学习笔记</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="gitalk-container"></div><script type="text/javascript">Fluid.utils.waitElementVisible("gitalk-container",(function(){Fluid.utils.createCssLink("/css/gitalk.css"),Fluid.utils.createScript("https://cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.min.js",(function(){new Gitalk({clientID:"af550312a411b96c64b9",clientSecret:"f11934265fd18324cb2d9fd605d7d445207a3e52",repo:"gitalk",owner:"AtroxQW",admin:["AtroxQW"],id:"5d132ed9cf8f43b512fa3eadd86877a2",language:"zh-CN",labels:["Gitalk"],perPage:10,pagerDirection:"last",createIssueManually:!0,distractionFreeMode:!1}).render("gitalk-container")}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script defer src="/js/leancloud.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/js/local-search.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script src="/js/boot.js"></script><script src="https://libs.xiaoz.top/instantclick/instantclick.min.js" data-no-instant></script><script data-no-instant>InstantClick.init()</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>